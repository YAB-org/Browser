/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/webx-wasmoon@1.16.4/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).wasmoon={})}(this,(function(e){"use strict";var t=class{constructor(e,t){this.target=e,this.options=t}};var r=class extends Array{},a=class extends Number{};let n=((s={})[s.Ok=0]="Ok",s[s.Yield=1]="Yield",s[s.ErrorRun=2]="ErrorRun",s[s.ErrorSyntax=3]="ErrorSyntax",s[s.ErrorMem=4]="ErrorMem",s[s.ErrorErr=5]="ErrorErr",s[s.ErrorFile=6]="ErrorFile",s);var s;const u=1e6,o=-1001e3;let l=((i={})[i.None=-1]="None",i[i.Nil=0]="Nil",i[i.Boolean=1]="Boolean",i[i.LightUserdata=2]="LightUserdata",i[i.Number=3]="Number",i[i.String=4]="String",i[i.Table=5]="Table",i[i.Function=6]="Function",i[i.Userdata=7]="Userdata",i[i.Thread=8]="Thread",i);var i;let c=((h={})[h.Call=0]="Call",h[h.Ret=1]="Ret",h[h.Line=2]="Line",h[h.Count=3]="Count",h[h.TailCall=4]="TailCall",h);var h;let d=((m={})[m.Call=1]="Call",m[m.Ret=2]="Ret",m[m.Line=4]="Line",m[m.Count=8]="Count",m);var m;let _=((p={}).Base="_G",p.Coroutine="coroutine",p.Table="table",p.IO="io",p.OS="os",p.String="string",p.UTF8="utf8",p.Math="math",p.Debug="debug",p.Package="package",p);var p,f=class extends Error{};var b=class e{address;lua;typeExtensions;closed=!1;hookFunctionPointer;timeout;parent;constructor(e,t,r,a){this.lua=e,this.typeExtensions=t,this.address=r,this.parent=a}newThread(){const t=this.lua.lua_newthread(this.address);if(!t)throw new Error("lua_newthread returned a null pointer");return new e(this.lua,this.typeExtensions,t,this.parent||this)}resetThread(){this.assertOk(this.lua.lua_resetthread(this.address))}loadString(e,t){const r=this.lua.module.lengthBytesUTF8(e),a=r+1,n=this.lua.module._malloc(a);try{this.lua.module.stringToUTF8(e,n,a),this.assertOk(this.lua.luaL_loadbufferx(this.address,n,r,t??n,null))}finally{this.lua.module._free(n)}}loadFile(e){this.assertOk(this.lua.luaL_loadfilex(this.address,e,null))}resume(e=0){const t=this.lua.module._malloc(4);try{this.lua.module.setValue(t,0,"i32");return{result:this.lua.lua_resume(this.address,null,e,t),resultCount:this.lua.module.getValue(t,"i32")}}finally{this.lua.module._free(t)}}getTop(){return this.lua.lua_gettop(this.address)}setTop(e){this.lua.lua_settop(this.address,e)}remove(e){return this.lua.lua_remove(this.address,e)}setField(e,t,r){e=this.lua.lua_absindex(this.address,e),this.pushValue(r),this.lua.lua_setfield(this.address,e,t)}async run(e=0,t){const r=this.timeout;try{void 0!==t?.timeout&&this.setTimeout(Date.now()+t.timeout);let r=this.resume(e);for(;r.result===n.Yield;){if(this.timeout&&Date.now()>this.timeout)throw r.resultCount>0&&this.pop(r.resultCount),new f("thread timeout exceeded");if(r.resultCount>0){const e=this.getValue(-1);this.pop(r.resultCount),e===Promise.resolve(e)?await e:await new Promise((e=>setImmediate(e)))}else await new Promise((e=>setImmediate(e)));r=this.resume(0)}return this.assertOk(r.result),this.getStackValues()}finally{void 0!==t?.timeout&&this.setTimeout(r)}}runSync(e=0){const t=this.getTop()-e-1;return this.assertOk(this.lua.lua_pcallk(this.address,e,-1,0,0,null)),this.getStackValues(t)}pop(e=1){this.lua.lua_pop(this.address,e)}call(e,...t){const r=this.lua.lua_getglobal(this.address,e);if(r!==l.Function)throw new Error(`A function of type '${r}' was pushed, expected is ${l.Function}`);for(const e of t)this.pushValue(e);const a=this.getTop()-t.length-1;return this.lua.lua_callk(this.address,t.length,-1,0,null),this.getStackValues(a)}getStackValues(e=0){const t=this.getTop()-e,a=new r(t);for(let r=0;r<t;r++)a[r]=this.getValue(e+r+1);return a}stateToThread(t){return t===this.parent?.address?this.parent:new e(this.lua,this.typeExtensions,t,this.parent||this)}pushValue(t,r){const a=this.getValueDecorations(t),n=a.target;if(n instanceof e){return void(1===this.lua.lua_pushthread(n.address)||this.lua.lua_xmove(n.address,this.address,1))}const s=this.getTop();switch(typeof n){case"undefined":this.lua.lua_pushnil(this.address);break;case"number":Number.isInteger(n)?this.lua.lua_pushinteger(this.address,BigInt(n)):this.lua.lua_pushnumber(this.address,n);break;case"string":this.lua.lua_pushstring(this.address,n);break;case"boolean":this.lua.lua_pushboolean(this.address,n?1:0);break;default:if(this.typeExtensions.find((e=>e.extension.pushValue(this,a,r))))break;if(null===n){this.lua.lua_pushnil(this.address);break}throw new Error(`The type '${typeof n}' is not supported by Lua`)}if(a.options.metatable&&this.setMetatable(-1,a.options.metatable),this.getTop()!==s+1)throw new Error(`pushValue expected stack size ${s+1}, got ${this.getTop()}`)}setMetatable(e,t){if(e=this.lua.lua_absindex(this.address,e),this.lua.lua_getmetatable(this.address,e)){this.pop(1);const t=this.getMetatableName(e);throw new Error(`data already has associated metatable: ${t||"unknown name"}`)}this.pushValue(t),this.lua.lua_setmetatable(this.address,e)}getMetatableName(e){const t=this.lua.luaL_getmetafield(this.address,e,"__name");if(t===l.Nil)return;if(t!==l.String)return void this.pop(1);const r=this.lua.lua_tolstring(this.address,-1,null);return this.pop(1),r}getValue(e,t,r){e=this.lua.lua_absindex(this.address,e);const n=t??this.lua.lua_type(this.address,e);switch(n){case l.None:return;case l.Nil:return null;case l.Number:return this.lua.lua_tonumberx(this.address,e,null);case l.String:return this.lua.lua_tolstring(this.address,e,null);case l.Boolean:return Boolean(this.lua.lua_toboolean(this.address,e));case l.Thread:return this.stateToThread(this.lua.lua_tothread(this.address,e));default:{let t;n!==l.Table&&n!==l.Userdata||(t=this.getMetatableName(e));const s=this.typeExtensions.find((r=>r.extension.isType(this,e,n,t)));return s?s.extension.getValue(this,e,r):(console.warn(`The type '${this.lua.lua_typename(this.address,n)}' returned is not supported on JS`),new a(this.lua.lua_topointer(this.address,e)))}}}close(){this.isClosed()||(this.hookFunctionPointer&&this.lua.module.removeFunction(this.hookFunctionPointer),this.closed=!0)}setTimeout(e){e&&e>0?(this.hookFunctionPointer||(this.hookFunctionPointer=this.lua.module.addFunction((()=>{Date.now()>e&&(this.pushValue(new f("thread timeout exceeded")),this.lua.lua_error(this.address))}),"vii")),this.lua.lua_sethook(this.address,this.hookFunctionPointer,d.Count,1e3),this.timeout=e):this.hookFunctionPointer&&(this.hookFunctionPointer=void 0,this.timeout=void 0,this.lua.lua_sethook(this.address,null,0,0))}getTimeout(){return this.timeout}getPointer(e){return new a(this.lua.lua_topointer(this.address,e))}isClosed(){return!this.address||this.closed||Boolean(this.parent?.isClosed())}indexToString(e){const t=this.lua.luaL_tolstring(this.address,e,null);return this.pop(),t}dumpStack(e=console.log){const t=this.getTop();for(let r=1;r<=t;r++){const t=this.lua.lua_type(this.address,r);e(r,this.lua.lua_typename(this.address,t),this.getPointer(r),this.indexToString(r),this.getValue(r,t))}}assertOk(e){if(e!==n.Ok&&e!==n.Yield){const t=n[e],r=new Error(`Lua Error(${t}/${e})`);if(this.getTop()>0)if(e===n.ErrorMem)r.message=this.lua.lua_tolstring(this.address,-1,null);else{const e=this.getValue(-1);e instanceof Error&&(r.stack=e.stack),r.message=this.indexToString(-1)}if(e!==n.ErrorMem)try{this.lua.luaL_traceback(this.address,this.address,null,1);const e=this.lua.lua_tolstring(this.address,-1,null);"stack traceback:"!==e.trim()&&(r.message=`${r.message}\n${e}`),this.pop(1)}catch(e){console.warn("Failed to generate stack trace",e)}throw r}}getValueDecorations(e){return e instanceof t?e:new t(e,{})}},g=class extends b{memoryStats;allocatorFunctionPointer;constructor(e,t){if(t){const t={memoryUsed:0},r=e.module.addFunction(((r,a,n,s)=>{if(0===s)return a&&(t.memoryUsed-=n,e.module._free(a)),0;const u=a?s-n:s,o=t.memoryUsed+u;if(s>n&&t.memoryMax&&o>t.memoryMax)return 0;const l=e.module._realloc(a,s);return l&&(t.memoryUsed=o),l}),"iiiii"),a=e.lua_newstate(r,null);if(!a)throw e.module.removeFunction(r),new Error("lua_newstate returned a null pointer");super(e,[],a),this.memoryStats=t,this.allocatorFunctionPointer=r}else super(e,[],e.luaL_newstate());if(this.isClosed())throw new Error("Global state could not be created (probably due to lack of memory)")}close(){if(!this.isClosed()){super.close(),this.lua.lua_close(this.address),this.allocatorFunctionPointer&&this.lua.module.removeFunction(this.allocatorFunctionPointer);for(const e of this.typeExtensions)e.extension.close()}}registerTypeExtension(e,t){this.typeExtensions.push({extension:t,priority:e}),this.typeExtensions.sort(((e,t)=>t.priority-e.priority))}loadLibrary(e){switch(e){case _.Base:this.lua.luaopen_base(this.address);break;case _.Coroutine:this.lua.luaopen_coroutine(this.address);break;case _.Table:this.lua.luaopen_table(this.address);break;case _.IO:this.lua.luaopen_io(this.address);break;case _.OS:this.lua.luaopen_os(this.address);break;case _.String:this.lua.luaopen_string(this.address);break;case _.UTF8:this.lua.luaopen_utf8(this.address);break;case _.Math:this.lua.luaopen_math(this.address);break;case _.Debug:this.lua.luaopen_debug(this.address);break;case _.Package:this.lua.luaopen_package(this.address)}this.lua.lua_setglobal(this.address,e)}get(e){const t=this.lua.lua_getglobal(this.address,e),r=this.getValue(-1,t);return this.pop(),r}set(e,t){this.pushValue(t),this.lua.lua_setglobal(this.address,e)}getTable(e,t){const r=this.getTop(),a=this.lua.lua_getglobal(this.address,e);try{if(a!==l.Table)throw new TypeError(`Unexpected type in ${e}. Expected ${l[l.Table]}. Got ${l[a]}.`);t(r+1)}finally{this.getTop()!==r+1&&console.warn(`getTable: expected stack size ${r} got ${this.getTop()}`),this.setTop(r)}}getMemoryUsed(){return this.getMemoryStatsRef().memoryUsed}getMemoryMax(){return this.getMemoryStatsRef().memoryMax}setMemoryMax(e){this.getMemoryStatsRef().memoryMax=e}getMemoryStatsRef(){if(!this.memoryStats)throw new Error("Memory allocations is not being traced, please build engine with { traceAllocations: true }");return this.memoryStats}},w=class{name;thread;constructor(e,t){this.thread=e,this.name=t}isType(e,t,r,a){return r===l.Userdata&&a===this.name}getValue(e,t,r){const a=e.lua.luaL_testudata(e.address,t,this.name);if(!a)throw new Error(`data does not have the expected metatable: ${this.name}`);const n=e.lua.module.getValue(a,"*");return e.lua.getRef(n)}pushValue(e,t,r){const{target:a}=t,n=e.lua.ref(a),s=e.lua.lua_newuserdatauv(e.address,4,0);if(e.lua.module.setValue(s,n,"*"),l.Nil===e.lua.luaL_getmetatable(e.address,this.name))throw e.pop(2),new Error(`metatable not found: ${this.name}`);return e.lua.lua_setmetatable(e.address,-2),!0}},v=class extends w{gcPointer;constructor(e,t){if(super(e,"js_error"),this.gcPointer=e.lua.module.addFunction((t=>{const r=e.lua.luaL_checkudata(t,1,this.name),a=e.lua.module.getValue(r,"*");return e.lua.unref(a),n.Ok}),"ii"),e.lua.luaL_newmetatable(e.address,this.name)){const t=e.lua.lua_gettop(e.address);e.lua.lua_pushstring(e.address,"protected metatable"),e.lua.lua_setfield(e.address,t,"__metatable"),e.lua.lua_pushcclosure(e.address,this.gcPointer,0),e.lua.lua_setfield(e.address,t,"__gc"),e.pushValue(((e,t)=>"message"===t?e.message:null)),e.lua.lua_setfield(e.address,t,"__index"),e.pushValue((e=>e.message)),e.lua.lua_setfield(e.address,t,"__tostring")}e.lua.lua_pop(e.address,1),t&&e.set("Error",{create:e=>{if(e&&"string"!=typeof e)throw new Error("message must be a string");return new Error(e)}})}pushValue(e,t){return t.target instanceof Error&&super.pushValue(e,t)}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};var y=class{constructor(e){this.count=e}};function k(e,r){return new t(e,r)}var E=class extends w{functionRegistry="undefined"!=typeof FinalizationRegistry?new FinalizationRegistry((e=>{this.thread.isClosed()||this.thread.lua.luaL_unref(this.thread.address,o,e)})):void 0;gcPointer;functionWrapper;callbackContext;callbackContextIndex;options;constructor(e,t){super(e,"js_function"),this.options=t,this.callbackContext=e.newThread(),this.callbackContextIndex=this.thread.lua.luaL_ref(e.address,o),this.functionRegistry||console.warn("FunctionTypeExtension: FinalizationRegistry not found. Memory leaks likely."),this.gcPointer=e.lua.module.addFunction((t=>{e.lua.luaL_checkudata(t,1,this.name);const r=e.lua.luaL_checkudata(t,1,this.name),a=e.lua.module.getValue(r,"*");return e.lua.unref(a),n.Ok}),"ii"),e.lua.luaL_newmetatable(e.address,this.name)&&(e.lua.lua_pushstring(e.address,"__gc"),e.lua.lua_pushcclosure(e.address,this.gcPointer,0),e.lua.lua_settable(e.address,-3),e.lua.lua_pushstring(e.address,"__metatable"),e.lua.lua_pushstring(e.address,"protected metatable"),e.lua.lua_settable(e.address,-3)),e.lua.lua_pop(e.address,1),this.functionWrapper=e.lua.module.addFunction((t=>{const a=e.stateToThread(t),n=e.lua.luaL_checkudata(t,e.lua.lua_upvalueindex(1),this.name),s=e.lua.module.getValue(n,"*"),{target:u,options:o}=e.lua.getRef(s),l=a.getTop(),i=[];if(o.receiveThread&&i.push(a),o.receiveArgsQuantity)i.push(l);else for(let e=1;e<=l;e++){const t=a.getValue(e);1===e&&o?.self&&t===o.self||i.push(t)}try{const e=u.apply(o?.self,i);if(void 0===e)return 0;if(e instanceof y)return e.count;if(e instanceof r){for(const t of e)a.pushValue(t);return e.length}return a.pushValue(e),1}catch(e){if(e===1/0)throw e;return a.pushValue(e),a.lua.lua_error(a.address)}}),"ii")}close(){this.thread.lua.module.removeFunction(this.gcPointer),this.thread.lua.module.removeFunction(this.functionWrapper),this.callbackContext.close(),this.callbackContext.lua.luaL_unref(this.callbackContext.address,o,this.callbackContextIndex)}isType(e,t,r){return r===l.Function}pushValue(e,t){if("function"!=typeof t.target)return!1;const r=e.lua.ref(t),a=e.lua.lua_newuserdatauv(e.address,4,0);if(e.lua.module.setValue(a,r,"*"),l.Nil===e.lua.luaL_getmetatable(e.address,this.name))throw e.pop(1),e.lua.unref(r),new Error(`metatable not found: ${this.name}`);return e.lua.lua_setmetatable(e.address,-2),e.lua.lua_pushcclosure(e.address,this.functionWrapper,1),!0}getValue(e,t){e.lua.lua_pushvalue(e.address,t);const r=e.lua.luaL_ref(e.address,o),a=(...e)=>{if(this.callbackContext.isClosed())return void console.warn("Tried to call a function after closing lua state");const t=this.callbackContext.newThread();try{const a=t.lua.lua_rawgeti(t.address,o,BigInt(r));if(a!==l.Function){const e=t.lua.luaL_getmetafield(t.address,-1,"__call");if(t.pop(),e!==l.Function)throw new Error(`A value of type '${a}' was pushed but it is not callable`)}for(const r of e)t.pushValue(r);this.options?.functionTimeout&&t.setTimeout(Date.now()+this.options.functionTimeout);const s=t.resume(e.length);return s.result===n.Yield?new Promise(((e,r)=>{t.run(0).then((()=>{t.getTop()>0?e(t.getValue(-1)):e(void 0)})).catch(r)})):(t.assertOk(s.result),t.getTop()>0?t.getValue(-1):void 0)}finally{t.close(),this.callbackContext.pop()}};return this.functionRegistry?.register(a,r),a}};var L=class extends w{gcPointer;constructor(e){if(super(e,"js_null"),this.gcPointer=e.lua.module.addFunction((t=>{const r=e.lua.luaL_checkudata(t,1,this.name),a=e.lua.module.getValue(r,"*");return e.lua.unref(a),n.Ok}),"ii"),e.lua.luaL_newmetatable(e.address,this.name)){const t=e.lua.lua_gettop(e.address);e.lua.lua_pushstring(e.address,"protected metatable"),e.lua.lua_setfield(e.address,t,"__metatable"),e.lua.lua_pushcclosure(e.address,this.gcPointer,0),e.lua.lua_setfield(e.address,t,"__gc"),e.pushValue((()=>null)),e.lua.lua_setfield(e.address,t,"__index"),e.pushValue((()=>"null")),e.lua.lua_setfield(e.address,t,"__tostring"),e.pushValue(((e,t)=>e===t)),e.lua.lua_setfield(e.address,t,"__eq")}e.lua.lua_pop(e.address,1),super.pushValue(e,new t({},{})),e.lua.lua_setglobal(e.address,"null")}getValue(e,t){if(!e.lua.luaL_testudata(e.address,t,this.name))throw new Error(`data does not have the expected metatable: ${this.name}`);return null}pushValue(e,t){return null===t?.target&&(e.lua.lua_getglobal(e.address,"null"),!0)}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};const x=e=>e&&(Promise.resolve(e)===e||"function"==typeof e.then);var T=class extends w{gcPointer;constructor(e,t){if(super(e,"js_promise"),this.gcPointer=e.lua.module.addFunction((t=>{const r=e.lua.luaL_checkudata(t,1,this.name),a=e.lua.module.getValue(r,"*");return e.lua.unref(a),n.Ok}),"ii"),e.lua.luaL_newmetatable(e.address,this.name)){const t=e.lua.lua_gettop(e.address);e.lua.lua_pushstring(e.address,"protected metatable"),e.lua.lua_setfield(e.address,t,"__metatable"),e.lua.lua_pushcclosure(e.address,this.gcPointer,0),e.lua.lua_setfield(e.address,t,"__gc");const a=e=>{if(!x(e))throw new Error("self instance is not a promise");return!0};e.pushValue({next:(e,...t)=>a(e)&&e.then(...t),catch:(e,...t)=>a(e)&&e.catch(...t),finally:(e,...t)=>a(e)&&e.finally(...t),await:k(((t,n)=>{if(a(n),t.address===e.address)throw new Error("cannot await in the main thread");let s;const u=n.then((e=>{s={status:"fulfilled",value:e}})).catch((e=>{s={status:"rejected",value:e}})),o=this.thread.lua.module.addFunction((a=>{if(!s)return e.lua.lua_yieldk(t.address,0,0,o);this.thread.lua.module.removeFunction(o);const n=e.stateToThread(a);if("rejected"===s.status)return n.pushValue(s.value||new Error("promise rejected with no error")),this.thread.lua.lua_error(a);if(s.value instanceof y)return s.value.count;if(s.value instanceof r){for(const e of s.value)n.pushValue(e);return s.value.length}return n.pushValue(s.value),1}),"iiii");return t.pushValue(u),new y(e.lua.lua_yieldk(t.address,1,0,o))}),{receiveThread:!0})}),e.lua.lua_setfield(e.address,t,"__index"),e.pushValue(((e,t)=>e===t)),e.lua.lua_setfield(e.address,t,"__eq")}e.lua.lua_pop(e.address,1),t&&e.set("Promise",{create:e=>new Promise(e),all:e=>{if(!Array.isArray(e))throw new Error("argument must be an array of promises");return Promise.all(e.map((e=>Promise.resolve(e))))},resolve:e=>Promise.resolve(e)})}close(){this.thread.lua.module.removeFunction(this.gcPointer)}pushValue(e,t){return!!x(t.target)&&super.pushValue(e,t)}};function S(e,r){return new t(e,r||{})}var F=class extends w{gcPointer;constructor(e){if(super(e,"js_proxy"),this.gcPointer=e.lua.module.addFunction((t=>{const r=e.lua.luaL_checkudata(t,1,this.name),a=e.lua.module.getValue(r,"*");return e.lua.unref(a),n.Ok}),"ii"),e.lua.luaL_newmetatable(e.address,this.name)){const t=e.lua.lua_gettop(e.address);e.lua.lua_pushstring(e.address,"protected metatable"),e.lua.lua_setfield(e.address,t,"__metatable"),e.lua.lua_pushcclosure(e.address,this.gcPointer,0),e.lua.lua_setfield(e.address,t,"__gc"),e.pushValue(((e,t)=>{switch(typeof t){case"number":t-=1;case"string":break;default:throw new Error("Only strings or numbers can index js objects")}const r=e[t];return"function"==typeof r?k(r,{self:e}):r})),e.lua.lua_setfield(e.address,t,"__index"),e.pushValue(((e,t,r)=>{switch(typeof t){case"number":t-=1;case"string":break;default:throw new Error("Only strings or numbers can index js objects")}e[t]=r})),e.lua.lua_setfield(e.address,t,"__newindex"),e.pushValue((e=>e.toString?.()??typeof e)),e.lua.lua_setfield(e.address,t,"__tostring"),e.pushValue((e=>e.length||0)),e.lua.lua_setfield(e.address,t,"__len"),e.pushValue((e=>{const t=Object.getOwnPropertyNames(e);let a=0;return r.of((()=>{const n=r.of(t[a],e[t[a]]);return a++,n}),e,null)})),e.lua.lua_setfield(e.address,t,"__pairs"),e.pushValue(((e,t)=>e===t)),e.lua.lua_setfield(e.address,t,"__eq"),e.pushValue(((e,...t)=>(t[0]===e&&t.shift(),e(...t)))),e.lua.lua_setfield(e.address,t,"__call")}e.lua.lua_pop(e.address,1)}isType(e,t,r,a){return r===l.Userdata&&a===this.name}getValue(e,t){const r=e.lua.lua_touserdata(e.address,t),a=e.lua.module.getValue(r,"*");return e.lua.getRef(a)}pushValue(e,r){const{target:a,options:n}=r;if(void 0===n.proxy){if(null==a)return!1;if("object"!=typeof a){if(!("function"==typeof a&&a.prototype?.constructor===a&&a.toString().startsWith("class ")))return!1}if(x(a))return!1}else if(!1===n.proxy)return!1;return!n.metatable||n.metatable instanceof t?super.pushValue(e,r):(r.options.metatable=S(n.metatable,{proxy:!1}),!1)}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};var P=class extends w{constructor(e){super(e,"js_table")}close(){}isType(e,t,r){return r===l.Table}getValue(e,t,r){const a=r||new Map,n=e.lua.lua_topointer(e.address,t);let s=a.get(n);if(!s){const r=this.readTableKeys(e,t);s=r.length>0&&r.every(((e,t)=>e===String(t+1)))?[]:{},a.set(n,s),this.readTableValues(e,t,a,s)}return s}pushValue(e,{target:t},r){if("object"!=typeof t||null===t)return!1;const a=r||new Map,n=a.get(t);if(void 0!==n)return e.lua.lua_rawgeti(e.address,o,BigInt(n)),!0;try{const r=e.getTop()+1,n=(r,n)=>{e.lua.lua_createtable(e.address,r,n);const s=e.lua.luaL_ref(e.address,o);a.set(t,s),e.lua.lua_rawgeti(e.address,o,BigInt(s))};if(Array.isArray(t)){n(t.length,0);for(let n=0;n<t.length;n++)e.pushValue(n+1,a),e.pushValue(t[n],a),e.lua.lua_settable(e.address,r)}else{n(0,Object.getOwnPropertyNames(t).length);for(const n in t)e.pushValue(n,a),e.pushValue(t[n],a),e.lua.lua_settable(e.address,r)}}finally{if(void 0===r)for(const t of a.values())e.lua.luaL_unref(e.address,o,t)}return!0}readTableKeys(e,t){const r=[];for(e.lua.lua_pushnil(e.address);e.lua.lua_next(e.address,t);){const t=e.indexToString(-2);r.push(t),e.pop()}return r}readTableValues(e,t,r,a){const n=Array.isArray(a);for(e.lua.lua_pushnil(e.address);e.lua.lua_next(e.address,t);){const t=e.indexToString(-2),s=e.getValue(-1,void 0,r);n?a.push(s):a[t]=s,e.pop()}}};var D=class extends w{gcPointer;constructor(e){if(super(e,"js_userdata"),this.gcPointer=e.lua.module.addFunction((t=>{const r=e.lua.luaL_checkudata(t,1,this.name),a=e.lua.module.getValue(r,"*");return e.lua.unref(a),n.Ok}),"ii"),e.lua.luaL_newmetatable(e.address,this.name)){const t=e.lua.lua_gettop(e.address);e.lua.lua_pushstring(e.address,"protected metatable"),e.lua.lua_setfield(e.address,t,"__metatable"),e.lua.lua_pushcclosure(e.address,this.gcPointer,0),e.lua.lua_setfield(e.address,t,"__gc")}e.lua.lua_pop(e.address,1)}isType(e,t,r,a){return r===l.Userdata&&a===this.name}getValue(e,t){const r=e.lua.lua_touserdata(e.address,t),a=e.lua.module.getValue(r,"*");return e.lua.getRef(a)}pushValue(e,t){return!!t.options.reference&&super.pushValue(e,t)}close(){this.thread.lua.module.removeFunction(this.gcPointer)}};var M=class{global;constructor(e,{openStandardLibs:t=!0,injectObjects:r=!1,enableProxy:a=!0,traceAllocations:n=!1,functionTimeout:s}={}){var u;this.cmodule=e,this.global=new g(this.cmodule,n),this.global.registerTypeExtension(0,(u=this.global,new P(u))),this.global.registerTypeExtension(0,function(e,t){return new E(e,t)}(this.global,{functionTimeout:s})),this.global.registerTypeExtension(1,function(e,t){return new T(e,t)}(this.global,r)),r&&this.global.registerTypeExtension(5,function(e){return new L(e)}(this.global)),a?this.global.registerTypeExtension(3,function(e){return new F(e)}(this.global)):this.global.registerTypeExtension(1,function(e,t){return new v(e,t)}(this.global,r)),this.global.registerTypeExtension(4,function(e){return new D(e)}(this.global)),t&&this.cmodule.luaL_openlibs(this.global.address)}doString(e){return this.callByteCode((t=>t.loadString(e)))}doFile(e){return this.callByteCode((t=>t.loadFile(e)))}doStringSync(e){this.global.loadString(e);return this.global.runSync()[0]}doFileSync(e){this.global.loadFile(e);return this.global.runSync()[0]}async callByteCode(e){const t=this.global.newThread(),r=this.global.getTop();try{e(t);const r=await t.run(0);return r.length>0?t.getValue(t.getTop()-r.length+1):void 0}finally{this.global.remove(r)}}};var A=async function(e={}){var t=e,r="object"==typeof window,a="undefined"!=typeof WorkerGlobalScope,n="object"==typeof process&&process.versions?.node&&"renderer"!=process.type;if(n){const{createRequire:e}=await import("module");var s=e('https://raw.githubusercontent.com/YAB-org/Browser/refs/heads/main/wasmoon/index.js')}var u,o,l="./this.program",i=(e,t)=>{throw t},c='https://raw.githubusercontent.com/YAB-org/Browser/refs/heads/main/wasmoon/index.js',h="";if(n){var d=s("fs");c.startsWith("file:")&&(h=s("path").dirname(s("url").fileURLToPath(c))+"/"),o=e=>(e=F(e)?new URL(e):e,d.readFileSync(e)),u=async(e,t=!0)=>(e=F(e)?new URL(e):e,d.readFileSync(e,t?void 0:"utf8")),process.argv.length>1&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),i=(e,t)=>{throw process.exitCode=e,t}}else if(r||a){try{h=new URL(".",c).href}catch{}a&&(o=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),u=async e=>{var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)}}var m,_,p,f,b,g,w,v,y,k,E,L,x=console.log.bind(console),T=console.error.bind(console),S=!1,F=e=>e.startsWith("file://"),P=!1;function D(){var e=f.buffer;b=new Int8Array(e),w=new Int16Array(e),g=new Uint8Array(e),new Uint16Array(e),v=new Int32Array(e),y=new Uint32Array(e),k=new Float32Array(e),E=new Float64Array(e),L=new BigInt64Array(e),new BigUint64Array(e)}var M,A=0,C=null;function V(e){A++}function R(e){if(0==--A&&C){var t=C;C=null,t()}}function N(e){T(e="Aborted("+e+")"),S=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw p?.(t),t}function z(){return t.locateFile?(e="glue.wasm",t.locateFile?t.locateFile(e,h):h+e):new URL("glue.wasm",'https://raw.githubusercontent.com/YAB-org/Browser/refs/heads/main/wasmoon/index.js').href;var e}async function O(e){try{var t=await u(e);return new Uint8Array(t)}catch{}return function(e){if(o)return o(e);throw"both async and sync fetching of the wasm failed"}(e)}async function U(e,t,r){if(!e&&"function"==typeof WebAssembly.instantiateStreaming&&!n)try{var a=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(a,r)}catch(e){T(`wasm streaming compile failed: ${e}`),T("falling back to ArrayBuffer instantiation")}return async function(e,t){try{var r=await O(e);return await WebAssembly.instantiate(r,t)}catch(e){T(`failed to asynchronously prepare wasm: ${e}`),N(e)}}(t,r)}class j{name="ExitStatus";constructor(e){this.message=`Program terminated with exit(${e})`,this.status=e}}var B,I,$,q,W,G,H,Y=e=>{for(;e.length>0;)e.shift()(t)},X=[],K=e=>X.push(e),Q=e=>W(e),J=()=>H(),Z={isAbs:e=>"/"===e.charAt(0),splitPath:e=>/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1),normalizeArray:(e,t)=>{for(var r=0,a=e.length-1;a>=0;a--){var n=e[a];"."===n?e.splice(a,1):".."===n?(e.splice(a,1),r++):r&&(e.splice(a,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:e=>{var t=Z.isAbs(e),r="/"===e.slice(-1);return(e=Z.normalizeArray(e.split("/").filter((e=>!!e)),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:e=>{var t=Z.splitPath(e),r=t[0],a=t[1];return r||a?(a&&(a=a.slice(0,-1)),r+a):"."},basename:e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],join:(...e)=>Z.normalize(e.join("/")),join2:(e,t)=>Z.normalize(e+"/"+t)},ee=e=>{(ee=(()=>{if(n){var e=s("crypto");return t=>e.randomFillSync(t)}return e=>crypto.getRandomValues(e)})())(e)},te={resolve:(...e)=>{for(var t="",r=!1,a=e.length-1;a>=-1&&!r;a--){var n=a>=0?e[a]:me.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";t=n+"/"+t,r=Z.isAbs(n)}return(r?"/":"")+(t=Z.normalizeArray(t.split("/").filter((e=>!!e)),!r).join("/"))||"."},relative:(e,t)=>{function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=te.resolve(e).slice(1),t=te.resolve(t).slice(1);for(var a=r(e.split("/")),n=r(t.split("/")),s=Math.min(a.length,n.length),u=s,o=0;o<s;o++)if(a[o]!==n[o]){u=o;break}var l=[];for(o=u;o<a.length;o++)l.push("..");return(l=l.concat(n.slice(u))).join("/")}},re="undefined"!=typeof TextDecoder?new TextDecoder:void 0,ae=(e,t=0,r,a)=>{var n=((e,t,r,a)=>{var n=t+r;if(a)return n;for(;e[t]&&!(t>=n);)++t;return t})(e,t,r,a);if(n-t>16&&e.buffer&&re)return re.decode(e.subarray(t,n));for(var s="";t<n;){var u=e[t++];if(128&u){var o=63&e[t++];if(192!=(224&u)){var l=63&e[t++];if((u=224==(240&u)?(15&u)<<12|o<<6|l:(7&u)<<18|o<<12|l<<6|63&e[t++])<65536)s+=String.fromCharCode(u);else{var i=u-65536;s+=String.fromCharCode(55296|i>>10,56320|1023&i)}}else s+=String.fromCharCode((31&u)<<6|o)}else s+=String.fromCharCode(u)}return s},ne=[],se=e=>{for(var t=0,r=0;r<e.length;++r){var a=e.charCodeAt(r);a<=127?t++:a<=2047?t+=2:a>=55296&&a<=57343?(t+=4,++r):t+=3}return t},ue=(e,t,r,a)=>{if(!(a>0))return 0;for(var n=r,s=r+a-1,u=0;u<e.length;++u){var o=e.codePointAt(u);if(o<=127){if(r>=s)break;t[r++]=o}else if(o<=2047){if(r+1>=s)break;t[r++]=192|o>>6,t[r++]=128|63&o}else if(o<=65535){if(r+2>=s)break;t[r++]=224|o>>12,t[r++]=128|o>>6&63,t[r++]=128|63&o}else{if(r+3>=s)break;t[r++]=240|o>>18,t[r++]=128|o>>12&63,t[r++]=128|o>>6&63,t[r++]=128|63&o,u++}}return t[r]=0,r-n},oe=(e,t,r)=>{var a=r>0?r:se(e)+1,n=new Array(a),s=ue(e,n,0,n.length);return t&&(n.length=s),n},le={ttys:[],init(){},shutdown(){},register(e,t){le.ttys[e]={input:[],output:[],ops:t},me.registerDevice(e,le.stream_ops)},stream_ops:{open(e){var t=le.ttys[e.node.rdev];if(!t)throw new me.ErrnoError(43);e.tty=t,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,t,r,a,n){if(!e.tty||!e.tty.ops.get_char)throw new me.ErrnoError(60);for(var s=0,u=0;u<a;u++){var o;try{o=e.tty.ops.get_char(e.tty)}catch(e){throw new me.ErrnoError(29)}if(void 0===o&&0===s)throw new me.ErrnoError(6);if(null==o)break;s++,t[r+u]=o}return s&&(e.node.atime=Date.now()),s},write(e,t,r,a,n){if(!e.tty||!e.tty.ops.put_char)throw new me.ErrnoError(60);try{for(var s=0;s<a;s++)e.tty.ops.put_char(e.tty,t[r+s])}catch(e){throw new me.ErrnoError(29)}return a&&(e.node.mtime=e.node.ctime=Date.now()),s}},default_tty_ops:{get_char:e=>(()=>{if(!ne.length){var e=null;if(n){var t=Buffer.alloc(256),r=0,a=process.stdin.fd;try{r=d.readSync(a,t,0,256)}catch(e){if(!e.toString().includes("EOF"))throw e;r=0}r>0&&(e=t.slice(0,r).toString("utf-8"))}else"undefined"!=typeof window&&"function"==typeof window.prompt&&null!==(e=window.prompt("Input: "))&&(e+="\n");if(!e)return null;ne=oe(e,!0)}return ne.shift()})(),put_char(e,t){null===t||10===t?(x(ae(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){e.output?.length>0&&(x(ae(e.output)),e.output=[])},ioctl_tcgets:e=>({c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),ioctl_tcsets:(e,t,r)=>0,ioctl_tiocgwinsz:e=>[24,80]},default_tty1_ops:{put_char(e,t){null===t||10===t?(T(ae(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){e.output?.length>0&&(T(ae(e.output)),e.output=[])}}},ie=e=>{N()},ce={ops_table:null,mount:e=>ce.createNode(null,"/",16895,0),createNode(e,t,r,a){if(me.isBlkdev(r)||me.isFIFO(r))throw new me.ErrnoError(63);ce.ops_table||={dir:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr,lookup:ce.node_ops.lookup,mknod:ce.node_ops.mknod,rename:ce.node_ops.rename,unlink:ce.node_ops.unlink,rmdir:ce.node_ops.rmdir,readdir:ce.node_ops.readdir,symlink:ce.node_ops.symlink},stream:{llseek:ce.stream_ops.llseek}},file:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr},stream:{llseek:ce.stream_ops.llseek,read:ce.stream_ops.read,write:ce.stream_ops.write,mmap:ce.stream_ops.mmap,msync:ce.stream_ops.msync}},link:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr,readlink:ce.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ce.node_ops.getattr,setattr:ce.node_ops.setattr},stream:me.chrdev_stream_ops}};var n=me.createNode(e,t,r,a);return me.isDir(n.mode)?(n.node_ops=ce.ops_table.dir.node,n.stream_ops=ce.ops_table.dir.stream,n.contents={}):me.isFile(n.mode)?(n.node_ops=ce.ops_table.file.node,n.stream_ops=ce.ops_table.file.stream,n.usedBytes=0,n.contents=null):me.isLink(n.mode)?(n.node_ops=ce.ops_table.link.node,n.stream_ops=ce.ops_table.link.stream):me.isChrdev(n.mode)&&(n.node_ops=ce.ops_table.chrdev.node,n.stream_ops=ce.ops_table.chrdev.stream),n.atime=n.mtime=n.ctime=Date.now(),e&&(e.contents[t]=n,e.atime=e.mtime=e.ctime=n.atime),n},getFileDataAsTypedArray:e=>e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0),expandFileStorage(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));var a=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(a.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,t){if(e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var r=e.contents;e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr(e){var t={};return t.dev=me.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,me.isDir(e.mode)?t.size=4096:me.isFile(e.mode)?t.size=e.usedBytes:me.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr(e,t){for(const r of["mode","atime","mtime","ctime"])null!=t[r]&&(e[r]=t[r]);void 0!==t.size&&ce.resizeFileStorage(e,t.size)},lookup(e,t){throw ce.doesNotExistError||(ce.doesNotExistError=new me.ErrnoError(44),ce.doesNotExistError.stack="<generic error, no stack>"),ce.doesNotExistError},mknod:(e,t,r,a)=>ce.createNode(e,t,r,a),rename(e,t,r){var a;try{a=me.lookupNode(t,r)}catch(e){}if(a){if(me.isDir(e.mode))for(var n in a.contents)throw new me.ErrnoError(55);me.hashRemoveNode(a)}delete e.parent.contents[e.name],t.contents[r]=e,e.name=r,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.contents[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){var r=me.lookupNode(e,t);for(var a in r.contents)throw new me.ErrnoError(55);delete e.contents[t],e.ctime=e.mtime=Date.now()},readdir:e=>[".","..",...Object.keys(e.contents)],symlink(e,t,r){var a=ce.createNode(e,t,41471,0);return a.link=r,a},readlink(e){if(!me.isLink(e.mode))throw new me.ErrnoError(28);return e.link}},stream_ops:{read(e,t,r,a,n){var s=e.node.contents;if(n>=e.node.usedBytes)return 0;var u=Math.min(e.node.usedBytes-n,a);if(u>8&&s.subarray)t.set(s.subarray(n,n+u),r);else for(var o=0;o<u;o++)t[r+o]=s[n+o];return u},write(e,t,r,a,n,s){if(t.buffer===b.buffer&&(s=!1),!a)return 0;var u=e.node;if(u.mtime=u.ctime=Date.now(),t.subarray&&(!u.contents||u.contents.subarray)){if(s)return u.contents=t.subarray(r,r+a),u.usedBytes=a,a;if(0===u.usedBytes&&0===n)return u.contents=t.slice(r,r+a),u.usedBytes=a,a;if(n+a<=u.usedBytes)return u.contents.set(t.subarray(r,r+a),n),a}if(ce.expandFileStorage(u,n+a),u.contents.subarray&&t.subarray)u.contents.set(t.subarray(r,r+a),n);else for(var o=0;o<a;o++)u.contents[n+o]=t[r+o];return u.usedBytes=Math.max(u.usedBytes,n+a),a},llseek(e,t,r){var a=t;if(1===r?a+=e.position:2===r&&me.isFile(e.node.mode)&&(a+=e.node.usedBytes),a<0)throw new me.ErrnoError(28);return a},mmap(e,t,r,a,n){if(!me.isFile(e.node.mode))throw new me.ErrnoError(43);var s,u,o=e.node.contents;if(2&n||!o||o.buffer!==b.buffer){if(u=!0,!(s=ie()))throw new me.ErrnoError(48);o&&((r>0||r+t<o.length)&&(o=o.subarray?o.subarray(r,r+t):Array.prototype.slice.call(o,r,r+t)),b.set(o,s))}else u=!1,s=o.byteOffset;return{ptr:s,allocated:u}},msync:(e,t,r,a,n)=>(ce.stream_ops.write(e,t,0,a,r,!1),0)}},he=[],de=(e,t)=>{var r=0;return e&&(r|=365),t&&(r|=146),r},me={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,ErrnoError:class{name="ErrnoError";constructor(e){this.errno=e}},FSStream:class{shared={};get object(){return this.node}set object(e){this.node=e}get isRead(){return 1!=(2097155&this.flags)}get isWrite(){return!!(2097155&this.flags)}get isAppend(){return 1024&this.flags}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(e,t,r,a){e||(e=this),this.parent=e,this.mount=e.mount,this.id=me.nextInode++,this.name=t,this.mode=r,this.rdev=a,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return me.isDir(this.mode)}get isDevice(){return me.isChrdev(this.mode)}},lookupPath(e,t={}){if(!e)throw new me.ErrnoError(44);t.follow_mount??=!0,Z.isAbs(e)||(e=me.cwd()+"/"+e);e:for(var r=0;r<40;r++){for(var a=e.split("/").filter((e=>!!e)),n=me.root,s="/",u=0;u<a.length;u++){var o=u===a.length-1;if(o&&t.parent)break;if("."!==a[u])if(".."!==a[u]){s=Z.join2(s,a[u]);try{n=me.lookupNode(n,a[u])}catch(e){if(44===e?.errno&&o&&t.noent_okay)return{path:s};throw e}if(!me.isMountpoint(n)||o&&!t.follow_mount||(n=n.mounted.root),me.isLink(n.mode)&&(!o||t.follow)){if(!n.node_ops.readlink)throw new me.ErrnoError(52);var l=n.node_ops.readlink(n);Z.isAbs(l)||(l=Z.dirname(s)+"/"+l),e=l+"/"+a.slice(u+1).join("/");continue e}}else{if(s=Z.dirname(s),me.isRoot(n)){e=s+"/"+a.slice(u+1).join("/"),r--;continue e}n=n.parent}}return{path:s,node:n}}throw new me.ErrnoError(32)},getPath(e){for(var t;;){if(me.isRoot(e)){var r=e.mount.mountpoint;return t?"/"!==r[r.length-1]?`${r}/${t}`:r+t:r}t=t?`${e.name}/${t}`:e.name,e=e.parent}},hashName(e,t){for(var r=0,a=0;a<t.length;a++)r=(r<<5)-r+t.charCodeAt(a)|0;return(e+r>>>0)%me.nameTable.length},hashAddNode(e){var t=me.hashName(e.parent.id,e.name);e.name_next=me.nameTable[t],me.nameTable[t]=e},hashRemoveNode(e){var t=me.hashName(e.parent.id,e.name);if(me.nameTable[t]===e)me.nameTable[t]=e.name_next;else for(var r=me.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode(e,t){var r=me.mayLookup(e);if(r)throw new me.ErrnoError(r);for(var a=me.hashName(e.id,t),n=me.nameTable[a];n;n=n.name_next){var s=n.name;if(n.parent.id===e.id&&s===t)return n}return me.lookup(e,t)},createNode(e,t,r,a){var n=new me.FSNode(e,t,r,a);return me.hashAddNode(n),n},destroyNode(e){me.hashRemoveNode(e)},isRoot:e=>e===e.parent,isMountpoint:e=>!!e.mounted,isFile:e=>32768==(61440&e),isDir:e=>16384==(61440&e),isLink:e=>40960==(61440&e),isChrdev:e=>8192==(61440&e),isBlkdev:e=>24576==(61440&e),isFIFO:e=>4096==(61440&e),isSocket:e=>!(49152&~e),flagsToPermissionString(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:(e,t)=>me.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2,mayLookup(e){if(!me.isDir(e.mode))return 54;var t=me.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate(e,t){if(!me.isDir(e.mode))return 54;try{me.lookupNode(e,t);return 20}catch(e){}return me.nodePermissions(e,"wx")},mayDelete(e,t,r){var a;try{a=me.lookupNode(e,t)}catch(e){return e.errno}var n=me.nodePermissions(e,"wx");if(n)return n;if(r){if(!me.isDir(a.mode))return 54;if(me.isRoot(a)||me.getPath(a)===me.cwd())return 10}else if(me.isDir(a.mode))return 31;return 0},mayOpen:(e,t)=>e?me.isLink(e.mode)?32:me.isDir(e.mode)&&("r"!==me.flagsToPermissionString(t)||576&t)?31:me.nodePermissions(e,me.flagsToPermissionString(t)):44,checkOpExists(e,t){if(!e)throw new me.ErrnoError(t);return e},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=me.MAX_OPEN_FDS;e++)if(!me.streams[e])return e;throw new me.ErrnoError(33)},getStreamChecked(e){var t=me.getStream(e);if(!t)throw new me.ErrnoError(8);return t},getStream:e=>me.streams[e],createStream:(e,t=-1)=>(e=Object.assign(new me.FSStream,e),-1==t&&(t=me.nextfd()),e.fd=t,me.streams[t]=e,e),closeStream(e){me.streams[e]=null},dupStream(e,t=-1){var r=me.createStream(e,t);return r.stream_ops?.dup?.(r),r},doSetAttr(e,t,r){var a=e?.stream_ops.setattr,n=a?e:t;a??=t.node_ops.setattr,me.checkOpExists(a,63),a(n,r)},chrdev_stream_ops:{open(e){var t=me.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open?.(e)},llseek(){throw new me.ErrnoError(70)}},major:e=>e>>8,minor:e=>255&e,makedev:(e,t)=>e<<8|t,registerDevice(e,t){me.devices[e]={stream_ops:t}},getDevice:e=>me.devices[e],getMounts(e){for(var t=[],r=[e];r.length;){var a=r.pop();t.push(a),r.push(...a.mounts)}return t},syncfs(e,t){"function"==typeof e&&(t=e,e=!1),me.syncFSRequests++,me.syncFSRequests>1&&T(`warning: ${me.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var r=me.getMounts(me.root.mount),a=0;function n(e){return me.syncFSRequests--,t(e)}function s(e){if(e)return s.errored?void 0:(s.errored=!0,n(e));++a>=r.length&&n(null)}r.forEach((t=>{if(!t.type.syncfs)return s(null);t.type.syncfs(t,e,s)}))},mount(e,t,r){var a,n="/"===r,s=!r;if(n&&me.root)throw new me.ErrnoError(10);if(!n&&!s){var u=me.lookupPath(r,{follow_mount:!1});if(r=u.path,a=u.node,me.isMountpoint(a))throw new me.ErrnoError(10);if(!me.isDir(a.mode))throw new me.ErrnoError(54)}var o={type:e,opts:t,mountpoint:r,mounts:[]},l=e.mount(o);return l.mount=o,o.root=l,n?me.root=l:a&&(a.mounted=o,a.mount&&a.mount.mounts.push(o)),l},unmount(e){var t=me.lookupPath(e,{follow_mount:!1});if(!me.isMountpoint(t.node))throw new me.ErrnoError(28);var r=t.node,a=r.mounted,n=me.getMounts(a);Object.keys(me.nameTable).forEach((e=>{for(var t=me.nameTable[e];t;){var r=t.name_next;n.includes(t.mount)&&me.destroyNode(t),t=r}})),r.mounted=null;var s=r.mount.mounts.indexOf(a);r.mount.mounts.splice(s,1)},lookup:(e,t)=>e.node_ops.lookup(e,t),mknod(e,t,r){var a=me.lookupPath(e,{parent:!0}).node,n=Z.basename(e);if(!n)throw new me.ErrnoError(28);if("."===n||".."===n)throw new me.ErrnoError(20);var s=me.mayCreate(a,n);if(s)throw new me.ErrnoError(s);if(!a.node_ops.mknod)throw new me.ErrnoError(63);return a.node_ops.mknod(a,n,t,r)},statfs:e=>me.statfsNode(me.lookupPath(e,{follow:!0}).node),statfsStream:e=>me.statfsNode(e.node),statfsNode(e){var t={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:me.nextInode,ffree:me.nextInode-1,fsid:42,flags:2,namelen:255};return e.node_ops.statfs&&Object.assign(t,e.node_ops.statfs(e.mount.opts.root)),t},create:(e,t=438)=>(t&=4095,t|=32768,me.mknod(e,t,0)),mkdir:(e,t=511)=>(t&=1023,t|=16384,me.mknod(e,t,0)),mkdirTree(e,t){var r=e.split("/"),a="";for(var n of r)if(n){(a||Z.isAbs(e))&&(a+="/"),a+=n;try{me.mkdir(a,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:(e,t,r)=>(void 0===r&&(r=t,t=438),t|=8192,me.mknod(e,t,r)),symlink(e,t){if(!te.resolve(e))throw new me.ErrnoError(44);var r=me.lookupPath(t,{parent:!0}).node;if(!r)throw new me.ErrnoError(44);var a=Z.basename(t),n=me.mayCreate(r,a);if(n)throw new me.ErrnoError(n);if(!r.node_ops.symlink)throw new me.ErrnoError(63);return r.node_ops.symlink(r,a,e)},rename(e,t){var r,a,n=Z.dirname(e),s=Z.dirname(t),u=Z.basename(e),o=Z.basename(t);if(r=me.lookupPath(e,{parent:!0}).node,a=me.lookupPath(t,{parent:!0}).node,!r||!a)throw new me.ErrnoError(44);if(r.mount!==a.mount)throw new me.ErrnoError(75);var l,i=me.lookupNode(r,u),c=te.relative(e,s);if("."!==c.charAt(0))throw new me.ErrnoError(28);if("."!==(c=te.relative(t,n)).charAt(0))throw new me.ErrnoError(55);try{l=me.lookupNode(a,o)}catch(e){}if(i!==l){var h=me.isDir(i.mode),d=me.mayDelete(r,u,h);if(d)throw new me.ErrnoError(d);if(d=l?me.mayDelete(a,o,h):me.mayCreate(a,o))throw new me.ErrnoError(d);if(!r.node_ops.rename)throw new me.ErrnoError(63);if(me.isMountpoint(i)||l&&me.isMountpoint(l))throw new me.ErrnoError(10);if(a!==r&&(d=me.nodePermissions(r,"w")))throw new me.ErrnoError(d);me.hashRemoveNode(i);try{r.node_ops.rename(i,a,o),i.parent=a}catch(e){throw e}finally{me.hashAddNode(i)}}},rmdir(e){var t=me.lookupPath(e,{parent:!0}).node,r=Z.basename(e),a=me.lookupNode(t,r),n=me.mayDelete(t,r,!0);if(n)throw new me.ErrnoError(n);if(!t.node_ops.rmdir)throw new me.ErrnoError(63);if(me.isMountpoint(a))throw new me.ErrnoError(10);t.node_ops.rmdir(t,r),me.destroyNode(a)},readdir(e){var t=me.lookupPath(e,{follow:!0}).node;return me.checkOpExists(t.node_ops.readdir,54)(t)},unlink(e){var t=me.lookupPath(e,{parent:!0}).node;if(!t)throw new me.ErrnoError(44);var r=Z.basename(e),a=me.lookupNode(t,r),n=me.mayDelete(t,r,!1);if(n)throw new me.ErrnoError(n);if(!t.node_ops.unlink)throw new me.ErrnoError(63);if(me.isMountpoint(a))throw new me.ErrnoError(10);t.node_ops.unlink(t,r),me.destroyNode(a)},readlink(e){var t=me.lookupPath(e).node;if(!t)throw new me.ErrnoError(44);if(!t.node_ops.readlink)throw new me.ErrnoError(28);return t.node_ops.readlink(t)},stat(e,t){var r=me.lookupPath(e,{follow:!t}).node;return me.checkOpExists(r.node_ops.getattr,63)(r)},fstat(e){var t=me.getStreamChecked(e),r=t.node,a=t.stream_ops.getattr,n=a?t:r;return a??=r.node_ops.getattr,me.checkOpExists(a,63),a(n)},lstat:e=>me.stat(e,!0),doChmod(e,t,r,a){me.doSetAttr(e,t,{mode:4095&r|-4096&t.mode,ctime:Date.now(),dontFollow:a})},chmod(e,t,r){var a;"string"==typeof e?a=me.lookupPath(e,{follow:!r}).node:a=e;me.doChmod(null,a,t,r)},lchmod(e,t){me.chmod(e,t,!0)},fchmod(e,t){var r=me.getStreamChecked(e);me.doChmod(r,r.node,t,!1)},doChown(e,t,r){me.doSetAttr(e,t,{timestamp:Date.now(),dontFollow:r})},chown(e,t,r,a){var n;"string"==typeof e?n=me.lookupPath(e,{follow:!a}).node:n=e;me.doChown(null,n,a)},lchown(e,t,r){me.chown(e,t,r,!0)},fchown(e,t,r){var a=me.getStreamChecked(e);me.doChown(a,a.node,!1)},doTruncate(e,t,r){if(me.isDir(t.mode))throw new me.ErrnoError(31);if(!me.isFile(t.mode))throw new me.ErrnoError(28);var a=me.nodePermissions(t,"w");if(a)throw new me.ErrnoError(a);me.doSetAttr(e,t,{size:r,timestamp:Date.now()})},truncate(e,t){if(t<0)throw new me.ErrnoError(28);var r;"string"==typeof e?r=me.lookupPath(e,{follow:!0}).node:r=e;me.doTruncate(null,r,t)},ftruncate(e,t){var r=me.getStreamChecked(e);if(t<0||!(2097155&r.flags))throw new me.ErrnoError(28);me.doTruncate(r,r.node,t)},utime(e,t,r){var a=me.lookupPath(e,{follow:!0}).node;me.checkOpExists(a.node_ops.setattr,63)(a,{atime:t,mtime:r})},open(e,t,r=438){if(""===e)throw new me.ErrnoError(44);var a,n;if(r=64&(t="string"==typeof t?(e=>{var t={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[e];if(void 0===t)throw new Error(`Unknown file open mode: ${e}`);return t})(t):t)?4095&r|32768:0,"object"==typeof e)a=e;else{n=e.endsWith("/");var s=me.lookupPath(e,{follow:!(131072&t),noent_okay:!0});a=s.node,e=s.path}var u=!1;if(64&t)if(a){if(128&t)throw new me.ErrnoError(20)}else{if(n)throw new me.ErrnoError(31);a=me.mknod(e,511|r,0),u=!0}if(!a)throw new me.ErrnoError(44);if(me.isChrdev(a.mode)&&(t&=-513),65536&t&&!me.isDir(a.mode))throw new me.ErrnoError(54);if(!u){var o=me.mayOpen(a,t);if(o)throw new me.ErrnoError(o)}512&t&&!u&&me.truncate(a,0),t&=-131713;var l=me.createStream({node:a,path:me.getPath(a),flags:t,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1});return l.stream_ops.open&&l.stream_ops.open(l),u&&me.chmod(a,511&r),l},close(e){if(me.isClosed(e))throw new me.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{me.closeStream(e.fd)}e.fd=null},isClosed:e=>null===e.fd,llseek(e,t,r){if(me.isClosed(e))throw new me.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new me.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new me.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read(e,t,r,a,n){if(a<0||n<0)throw new me.ErrnoError(28);if(me.isClosed(e))throw new me.ErrnoError(8);if(1==(2097155&e.flags))throw new me.ErrnoError(8);if(me.isDir(e.node.mode))throw new me.ErrnoError(31);if(!e.stream_ops.read)throw new me.ErrnoError(28);var s=void 0!==n;if(s){if(!e.seekable)throw new me.ErrnoError(70)}else n=e.position;var u=e.stream_ops.read(e,t,r,a,n);return s||(e.position+=u),u},write(e,t,r,a,n,s){if(a<0||n<0)throw new me.ErrnoError(28);if(me.isClosed(e))throw new me.ErrnoError(8);if(!(2097155&e.flags))throw new me.ErrnoError(8);if(me.isDir(e.node.mode))throw new me.ErrnoError(31);if(!e.stream_ops.write)throw new me.ErrnoError(28);e.seekable&&1024&e.flags&&me.llseek(e,0,2);var u=void 0!==n;if(u){if(!e.seekable)throw new me.ErrnoError(70)}else n=e.position;var o=e.stream_ops.write(e,t,r,a,n,s);return u||(e.position+=o),o},mmap(e,t,r,a,n){if(2&a&&!(2&n)&&2!=(2097155&e.flags))throw new me.ErrnoError(2);if(1==(2097155&e.flags))throw new me.ErrnoError(2);if(!e.stream_ops.mmap)throw new me.ErrnoError(43);if(!t)throw new me.ErrnoError(28);return e.stream_ops.mmap(e,t,r,a,n)},msync:(e,t,r,a,n)=>e.stream_ops.msync?e.stream_ops.msync(e,t,r,a,n):0,ioctl(e,t,r){if(!e.stream_ops.ioctl)throw new me.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile(e,t={}){if(t.flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error(`Invalid encoding type "${t.encoding}"`);var r=me.open(e,t.flags),a=me.stat(e).size,n=new Uint8Array(a);return me.read(r,n,0,a,0),"utf8"===t.encoding&&(n=ae(n)),me.close(r),n},writeFile(e,t,r={}){r.flags=r.flags||577;var a=me.open(e,r.flags,r.mode);if("string"==typeof t&&(t=new Uint8Array(oe(t,!0))),!ArrayBuffer.isView(t))throw new Error("Unsupported data type");me.write(a,t,0,t.byteLength,void 0,r.canOwn),me.close(a)},cwd:()=>me.currentPath,chdir(e){var t=me.lookupPath(e,{follow:!0});if(null===t.node)throw new me.ErrnoError(44);if(!me.isDir(t.node.mode))throw new me.ErrnoError(54);var r=me.nodePermissions(t.node,"x");if(r)throw new me.ErrnoError(r);me.currentPath=t.path},createDefaultDirectories(){me.mkdir("/tmp"),me.mkdir("/home"),me.mkdir("/home/web_user")},createDefaultDevices(){me.mkdir("/dev"),me.registerDevice(me.makedev(1,3),{read:()=>0,write:(e,t,r,a,n)=>a,llseek:()=>0}),me.mkdev("/dev/null",me.makedev(1,3)),le.register(me.makedev(5,0),le.default_tty_ops),le.register(me.makedev(6,0),le.default_tty1_ops),me.mkdev("/dev/tty",me.makedev(5,0)),me.mkdev("/dev/tty1",me.makedev(6,0));var e=new Uint8Array(1024),t=0,r=()=>(0===t&&(ee(e),t=e.byteLength),e[--t]);me.createDevice("/dev","random",r),me.createDevice("/dev","urandom",r),me.mkdir("/dev/shm"),me.mkdir("/dev/shm/tmp")},createSpecialDirectories(){me.mkdir("/proc");var e=me.mkdir("/proc/self");me.mkdir("/proc/self/fd"),me.mount({mount(){var t=me.createNode(e,"fd",16895,73);return t.stream_ops={llseek:ce.stream_ops.llseek},t.node_ops={lookup(e,t){var r=+t,a=me.getStreamChecked(r),n={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>a.path},id:r+1};return n.parent=n,n},readdir:()=>Array.from(me.streams.entries()).filter((([e,t])=>t)).map((([e,t])=>e.toString()))},t}},{},"/proc/self/fd")},createStandardStreams(e,t,r){e?me.createDevice("/dev","stdin",e):me.symlink("/dev/tty","/dev/stdin"),t?me.createDevice("/dev","stdout",null,t):me.symlink("/dev/tty","/dev/stdout"),r?me.createDevice("/dev","stderr",null,r):me.symlink("/dev/tty1","/dev/stderr");me.open("/dev/stdin",0),me.open("/dev/stdout",1),me.open("/dev/stderr",1)},staticInit(){me.nameTable=new Array(4096),me.mount(ce,{},"/"),me.createDefaultDirectories(),me.createDefaultDevices(),me.createSpecialDirectories(),me.filesystems={MEMFS:ce}},init(e,t,r){me.initialized=!0,me.createStandardStreams(e,t,r)},quit(){for(var e of(me.initialized=!1,me.streams))e&&me.close(e)},findObject(e,t){var r=me.analyzePath(e,t);return r.exists?r.object:null},analyzePath(e,t){try{e=(a=me.lookupPath(e,{follow:!t})).path}catch(e){}var r={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var a=me.lookupPath(e,{parent:!0});r.parentExists=!0,r.parentPath=a.path,r.parentObject=a.node,r.name=Z.basename(e),a=me.lookupPath(e,{follow:!t}),r.exists=!0,r.path=a.path,r.object=a.node,r.name=a.node.name,r.isRoot="/"===a.path}catch(e){r.error=e.errno}return r},createPath(e,t,r,a){e="string"==typeof e?e:me.getPath(e);for(var n=t.split("/").reverse();n.length;){var s=n.pop();if(s){var u=Z.join2(e,s);try{me.mkdir(u)}catch(e){if(20!=e.errno)throw e}e=u}}return u},createFile(e,t,r,a,n){var s=Z.join2("string"==typeof e?e:me.getPath(e),t),u=de(a,n);return me.create(s,u)},createDataFile(e,t,r,a,n,s){var u=t;e&&(e="string"==typeof e?e:me.getPath(e),u=t?Z.join2(e,t):e);var o=de(a,n),l=me.create(u,o);if(r){if("string"==typeof r){for(var i=new Array(r.length),c=0,h=r.length;c<h;++c)i[c]=r.charCodeAt(c);r=i}me.chmod(l,146|o);var d=me.open(l,577);me.write(d,r,0,r.length,0,s),me.close(d),me.chmod(l,o)}},createDevice(e,t,r,a){var n=Z.join2("string"==typeof e?e:me.getPath(e),t),s=de(!!r,!!a);me.createDevice.major??=64;var u=me.makedev(me.createDevice.major++,0);return me.registerDevice(u,{open(e){e.seekable=!1},close(e){a?.buffer?.length&&a(10)},read(e,t,a,n,s){for(var u=0,o=0;o<n;o++){var l;try{l=r()}catch(e){throw new me.ErrnoError(29)}if(void 0===l&&0===u)throw new me.ErrnoError(6);if(null==l)break;u++,t[a+o]=l}return u&&(e.node.atime=Date.now()),u},write(e,t,r,n,s){for(var u=0;u<n;u++)try{a(t[r+u])}catch(e){throw new me.ErrnoError(29)}return n&&(e.node.mtime=e.node.ctime=Date.now()),u}}),me.mkdev(n,s,u)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{e.contents=o(e.url),e.usedBytes=e.contents.length}catch(e){throw new me.ErrnoError(29)}},createLazyFile(e,t,r,n,s){class u{lengthKnown=!1;chunks=[];get(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,r=e/this.chunkSize|0;return this.getter(r)[t]}}setDataGetter(e){this.getter=e}cacheLength(){var e=new XMLHttpRequest;if(e.open("HEAD",r,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+r+". Status: "+e.status);var t,a=Number(e.getResponseHeader("Content-length")),n=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,s=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,u=1048576;n||(u=a);var o=this;o.setDataGetter((e=>{var t=e*u,n=(e+1)*u-1;if(n=Math.min(n,a-1),void 0===o.chunks[e]&&(o.chunks[e]=((e,t)=>{if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>a-1)throw new Error("only "+a+" bytes available! programmer error!");var n=new XMLHttpRequest;if(n.open("GET",r,!1),a!==u&&n.setRequestHeader("Range","bytes="+e+"-"+t),n.responseType="arraybuffer",n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.send(null),!(n.status>=200&&n.status<300||304===n.status))throw new Error("Couldn't load "+r+". Status: "+n.status);return void 0!==n.response?new Uint8Array(n.response||[]):oe(n.responseText||"",!0)})(t,n)),void 0===o.chunks[e])throw new Error("doXHR failed!");return o.chunks[e]})),!s&&a||(u=a=1,a=this.getter(0).length,u=a,x("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=a,this._chunkSize=u,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if("undefined"!=typeof XMLHttpRequest){if(!a)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var o={isDevice:!1,contents:new u}}else o={isDevice:!1,url:r};var l=me.createFile(e,t,o,n,s);o.contents?l.contents=o.contents:o.url&&(l.contents=null,l.url=o.url),Object.defineProperties(l,{usedBytes:{get:function(){return this.contents.length}}});var i={};function c(e,t,r,a,n){var s=e.node.contents;if(n>=s.length)return 0;var u=Math.min(s.length-n,a);if(s.slice)for(var o=0;o<u;o++)t[r+o]=s[n+o];else for(o=0;o<u;o++)t[r+o]=s.get(n+o);return u}return Object.keys(l.stream_ops).forEach((e=>{var t=l.stream_ops[e];i[e]=(...e)=>(me.forceLoadFile(l),t(...e))})),i.read=(e,t,r,a,n)=>(me.forceLoadFile(l),c(e,t,r,a,n)),i.mmap=(e,t,r,a,n)=>{me.forceLoadFile(l);var s=ie();if(!s)throw new me.ErrnoError(48);return c(e,b,s,t,r),{ptr:s,allocated:!0}},l.stream_ops=i,l}},_e=(e,t,r)=>e?ae(g,e,t,r):"",pe={DEFAULT_POLLMASK:5,calculateAt(e,t,r){if(Z.isAbs(t))return t;var a;-100===e?a=me.cwd():a=pe.getStreamFromFD(e).path;if(0==t.length){if(!r)throw new me.ErrnoError(44);return a}return a+"/"+t},writeStat(e,t){v[e>>2]=t.dev,v[e+4>>2]=t.mode,y[e+8>>2]=t.nlink,v[e+12>>2]=t.uid,v[e+16>>2]=t.gid,v[e+20>>2]=t.rdev,L[e+24>>3]=BigInt(t.size),v[e+32>>2]=4096,v[e+36>>2]=t.blocks;var r=t.atime.getTime(),a=t.mtime.getTime(),n=t.ctime.getTime();return L[e+40>>3]=BigInt(Math.floor(r/1e3)),y[e+48>>2]=r%1e3*1e3*1e3,L[e+56>>3]=BigInt(Math.floor(a/1e3)),y[e+64>>2]=a%1e3*1e3*1e3,L[e+72>>3]=BigInt(Math.floor(n/1e3)),y[e+80>>2]=n%1e3*1e3*1e3,L[e+88>>3]=BigInt(t.ino),0},writeStatFs(e,t){v[e+4>>2]=t.bsize,v[e+40>>2]=t.bsize,v[e+8>>2]=t.blocks,v[e+12>>2]=t.bfree,v[e+16>>2]=t.bavail,v[e+20>>2]=t.files,v[e+24>>2]=t.ffree,v[e+28>>2]=t.fsid,v[e+44>>2]=t.flags,v[e+36>>2]=t.namelen},doMsync(e,t,r,a,n){if(!me.isFile(t.node.mode))throw new me.ErrnoError(43);if(2&a)return 0;var s=g.slice(e,e+r);me.msync(t,s,n,r,a)},getStreamFromFD:e=>me.getStreamChecked(e),varargs:void 0,getStr:e=>_e(e)},fe=()=>{var e=v[+pe.varargs>>2];return pe.varargs+=4,e},be=fe,ge=(e,t,r)=>ue(e,g,t,r),we=e=>e<-9007199254740992||e>9007199254740992?NaN:Number(e),ve=[0,31,60,91,121,152,182,213,244,274,305,335],ye=[0,31,59,90,120,151,181,212,243,273,304,334],ke=e=>{var t;return((t=e.getFullYear())%4==0&&(t%100!=0||t%400==0)?ve:ye)[e.getMonth()]+e.getDate()-1},Ee=()=>Date.now(),Le=e=>{var t=(e-f.buffer.byteLength+65535)/65536|0;try{return f.grow(t),D(),1}catch(e){}},xe={},Te=()=>{if(!Te.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.language||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in xe)void 0===xe[t]?delete e[t]:e[t]=xe[t];var r=[];for(var t in e)r.push(`${t}=${e[t]}`);Te.strings=r}return Te.strings},Se=(e,t)=>{var r;r=e,i(r,new j(r))},Fe=[],Pe=e=>{var t=Fe[e];return t||(Fe[e]=t=B.get(e)),t},De=e=>G(e),Me=e=>{const t=e.length;return[t%128|128,t>>7,...e]},Ae={i:127,p:127,j:126,f:125,d:124,e:111},Ce=e=>Me(Array.from(e,(e=>Ae[e]))),Ve=e=>(I||(I=new WeakMap,((e,t)=>{if(I)for(var r=e;r<e+t;r++){var a=Pe(r);a&&I.set(a,r)}})(0,B.length)),I.get(e)||0),Re=[],Ne=(e,t)=>{B.set(e,t),Fe[e]=B.get(e)};me.createPreloadedFile=(e,t,r,a,n,s,o,l,i,c)=>{var h=t?te.resolve(Z.join2(e,t)):e;function d(r){function u(r){c?.(),l||((...e)=>{me.createDataFile(...e)})(e,t,r,a,n,i),s?.(),R()}((e,t,r,a)=>{"undefined"!=typeof Browser&&Browser.init();var n=!1;return he.forEach((s=>{n||s.canHandle(t)&&(s.handle(e,t,r,a),n=!0)})),n})(r,h,u,(()=>{o?.(),R()}))||u(r)}V(),"string"==typeof r?(async e=>{var t=await u(e);return new Uint8Array(t)})(r).then(d,o):d(r)},me.staticInit(),t.ENV=xe,t.ccall=(e,r,a,n,s)=>{var u={string:e=>{var t=0;return null!=e&&0!==e&&(t=(e=>{var t=se(e)+1,r=De(t);return ge(e,r,t),r})(e)),t},array:e=>{var t,r,a=De(e.length);return t=e,r=a,b.set(t,r),a}};var o=(e=>t["_"+e])(e),l=[],i=0;if(n)for(var c=0;c<n.length;c++){var h=u[a[c]];h?(0===i&&(i=J()),l[c]=h(n[c])):l[c]=n[c]}var d,m=o(...l);return d=m,0!==i&&Q(i),m=function(e){return"string"===r?_e(e):"boolean"===r?Boolean(e):e}(d),m},t.addFunction=(e,t)=>{var r=Ve(e);if(r)return r;var a=Re.length?Re.pop():B.grow(1);try{Ne(a,e)}catch(r){if(!(r instanceof TypeError))throw r;var n=((e,t)=>{var r=Uint8Array.of(0,97,115,109,1,0,0,0,1,...Me([1,96,...Ce(t.slice(1)),...Ce("v"===t[0]?"":t[0])]),2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),a=new WebAssembly.Module(r);return new WebAssembly.Instance(a,{e:{f:e}}).exports.f})(e,t);Ne(a,n)}return I.set(e,a),a},t.removeFunction=e=>{I.delete(Pe(e)),Ne(e,null),Re.push(e)},t.setValue=function(e,t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":b[e]=t;break;case"i16":w[e>>1]=t;break;case"i32":v[e>>2]=t;break;case"i64":L[e>>3]=BigInt(t);break;case"float":k[e>>2]=t;break;case"double":E[e>>3]=t;break;case"*":y[e>>2]=t;break;default:N(`invalid type for setValue: ${r}`)}},t.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return b[e];case"i16":return w[e>>1];case"i32":return v[e>>2];case"i64":return L[e>>3];case"float":return k[e>>2];case"double":return E[e>>3];case"*":return y[e>>2];default:N(`invalid type for getValue: ${t}`)}},t.stringToUTF8=ge,t.lengthBytesUTF8=se,t.stringToNewUTF8=e=>{var t=se(e)+1,r=$(t);return r&&ge(e,r,t),r},t.FS=me;var ze={x:function(e,t,r){try{var a=pe.getStreamFromFD(e);if(a.fd===t)return-28;if(t<0||t>=me.MAX_OPEN_FDS)return-8;var n=me.getStream(t);return n&&me.close(n),me.dupStream(a,t).fd}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return-e.errno}},a:function(e,t,r){pe.varargs=r;try{var a=pe.getStreamFromFD(e);switch(t){case 0:if((n=fe())<0)return-28;for(;me.streams[n];)n++;return me.dupStream(a,n).fd;case 1:case 2:case 13:case 14:return 0;case 3:return a.flags;case 4:var n=fe();return a.flags|=n,0;case 12:n=be();return w[n+0>>1]=2,0}return-28}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return-e.errno}},g:function(e,t,r){pe.varargs=r;try{var a=pe.getStreamFromFD(e);switch(t){case 21509:case 21510:case 21511:case 21512:case 21524:case 21515:return a.tty?0:-59;case 21505:if(!a.tty)return-59;if(a.tty.ops.ioctl_tcgets){var n=a.tty.ops.ioctl_tcgets(a),s=be();v[s>>2]=n.c_iflag||0,v[s+4>>2]=n.c_oflag||0,v[s+8>>2]=n.c_cflag||0,v[s+12>>2]=n.c_lflag||0;for(var u=0;u<32;u++)b[s+u+17]=n.c_cc[u]||0;return 0}return 0;case 21506:case 21507:case 21508:if(!a.tty)return-59;if(a.tty.ops.ioctl_tcsets){s=be();var o=v[s>>2],l=v[s+4>>2],i=v[s+8>>2],c=v[s+12>>2],h=[];for(u=0;u<32;u++)h.push(b[s+u+17]);return a.tty.ops.ioctl_tcsets(a.tty,t,{c_iflag:o,c_oflag:l,c_cflag:i,c_lflag:c,c_cc:h})}return 0;case 21519:if(!a.tty)return-59;s=be();return v[s>>2]=0,0;case 21520:return a.tty?-28:-59;case 21537:case 21531:s=be();return me.ioctl(a,t,s);case 21523:if(!a.tty)return-59;if(a.tty.ops.ioctl_tiocgwinsz){var d=a.tty.ops.ioctl_tiocgwinsz(a.tty);s=be();w[s>>1]=d[0],w[s+2>>1]=d[1]}return 0;default:return-28}}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return-e.errno}},d:function(e,t,r,a){pe.varargs=a;try{t=pe.getStr(t),t=pe.calculateAt(e,t);var n=a?fe():0;return me.open(t,r,n).fd}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return-e.errno}},l:function(e,t,r,a){try{if(t=pe.getStr(t),t=pe.calculateAt(e,t),a<=0)return-28;var n=me.readlink(t),s=Math.min(a,se(n)),u=b[r+s];return ge(n,r,a+1),b[r+s]=u,s}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return-e.errno}},n:function(e,t,r,a){try{return t=pe.getStr(t),a=pe.getStr(a),t=pe.calculateAt(e,t),a=pe.calculateAt(r,a),me.rename(t,a),0}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return-e.errno}},o:function(e){try{return e=pe.getStr(e),me.rmdir(e),0}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return-e.errno}},e:function(e,t,r){try{if(t=pe.getStr(t),t=pe.calculateAt(e,t),r){if(512!==r)return-28;me.rmdir(t)}else me.unlink(t);return 0}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return-e.errno}},p:()=>N(""),m:e=>{if(n){if(!e)return 1;var t=_e(e);if(!t.length)return 0;var r=s("child_process").spawnSync(t,[],{shell:!0,stdio:"inherit"}),a=(e,t)=>e<<8|t;if(null===r.status){return a(0,(e=>{switch(e){case"SIGHUP":return 1;case"SIGQUIT":return 3;case"SIGFPE":return 8;case"SIGKILL":return 9;case"SIGALRM":return 14;case"SIGTERM":return 15;default:return 2}})(r.signal))}return a(r.status,0)}return e?-52:0},j:()=>{throw 1/0},q:function(e,t){e=we(e);var r=new Date(1e3*e);v[t>>2]=r.getUTCSeconds(),v[t+4>>2]=r.getUTCMinutes(),v[t+8>>2]=r.getUTCHours(),v[t+12>>2]=r.getUTCDate(),v[t+16>>2]=r.getUTCMonth(),v[t+20>>2]=r.getUTCFullYear()-1900,v[t+24>>2]=r.getUTCDay();var a=Date.UTC(r.getUTCFullYear(),0,1,0,0,0,0),n=(r.getTime()-a)/864e5|0;v[t+28>>2]=n},r:function(e,t){e=we(e);var r=new Date(1e3*e);v[t>>2]=r.getSeconds(),v[t+4>>2]=r.getMinutes(),v[t+8>>2]=r.getHours(),v[t+12>>2]=r.getDate(),v[t+16>>2]=r.getMonth(),v[t+20>>2]=r.getFullYear()-1900,v[t+24>>2]=r.getDay();var a=0|ke(r);v[t+28>>2]=a,v[t+36>>2]=-60*r.getTimezoneOffset();var n=new Date(r.getFullYear(),0,1),s=new Date(r.getFullYear(),6,1).getTimezoneOffset(),u=n.getTimezoneOffset(),o=0|(s!=u&&r.getTimezoneOffset()==Math.min(u,s));v[t+32>>2]=o},s:function(e){var t=(()=>{var t=new Date(v[e+20>>2]+1900,v[e+16>>2],v[e+12>>2],v[e+8>>2],v[e+4>>2],v[e>>2],0),r=v[e+32>>2],a=t.getTimezoneOffset(),n=new Date(t.getFullYear(),0,1),s=new Date(t.getFullYear(),6,1).getTimezoneOffset(),u=n.getTimezoneOffset(),o=Math.min(u,s);if(r<0)v[e+32>>2]=Number(s!=u&&o==a);else if(r>0!=(o==a)){var l=Math.max(u,s),i=r>0?o:l;t.setTime(t.getTime()+6e4*(i-a))}v[e+24>>2]=t.getDay();var c=0|ke(t);v[e+28>>2]=c,v[e>>2]=t.getSeconds(),v[e+4>>2]=t.getMinutes(),v[e+8>>2]=t.getHours(),v[e+12>>2]=t.getDate(),v[e+16>>2]=t.getMonth(),v[e+20>>2]=t.getYear();var h=t.getTime();return isNaN(h)?-1:h/1e3})();return BigInt(t)},t:(e,t,r,a)=>{var n=(new Date).getFullYear(),s=new Date(n,0,1),u=new Date(n,6,1),o=s.getTimezoneOffset(),l=u.getTimezoneOffset(),i=Math.max(o,l);y[e>>2]=60*i,v[t>>2]=Number(o!=l);var c=e=>{var t=e>=0?"-":"+",r=Math.abs(e);return`UTC${t}${String(Math.floor(r/60)).padStart(2,"0")}${String(r%60).padStart(2,"0")}`},h=c(o),d=c(l);l<o?(ge(h,r,17),ge(d,a,17)):(ge(h,a,17),ge(d,r,17))},i:function(e,t,r){if(t=we(t),!((a=e)>=0&&a<=3))return 28;var a,n;n=0===e?Ee():performance.now();var s=Math.round(1e3*n*1e3);return L[r>>3]=BigInt(s),0},h:Ee,k:e=>{var t,r,a=g.length,n=2147483648;if((e>>>=0)>n)return!1;for(var s=1;s<=4;s*=2){var u=a*(1+.2/s);u=Math.min(u,e+100663296);var o=Math.min(n,(t=Math.max(e,u),r=65536,Math.ceil(t/r)*r));if(Le(o))return!0}return!1},v:(e,t)=>{var r=0,a=0;for(var n of Te()){var s=t+r;y[e+a>>2]=s,r+=ge(n,s,1/0)+1,a+=4}return 0},w:(e,t)=>{var r=Te();y[e>>2]=r.length;var a=0;for(var n of r)a+=se(n)+1;return y[t>>2]=a,0},y:Se,b:function(e){try{var t=pe.getStreamFromFD(e);return me.close(t),0}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return e.errno}},f:function(e,t,r,a){try{var n=((e,t,r,a)=>{for(var n=0,s=0;s<r;s++){var u=y[t>>2],o=y[t+4>>2];t+=8;var l=me.read(e,b,u,o,a);if(l<0)return-1;if(n+=l,l<o)break;void 0!==a&&(a+=l)}return n})(pe.getStreamFromFD(e),t,r);return y[a>>2]=n,0}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return e.errno}},u:function(e,t,r,a){t=we(t);try{if(isNaN(t))return 61;var n=pe.getStreamFromFD(e);return me.llseek(n,t,r),L[a>>3]=BigInt(n.position),n.getdents&&0===t&&0===r&&(n.getdents=null),0}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return e.errno}},c:function(e,t,r,a){try{var n=((e,t,r,a)=>{for(var n=0,s=0;s<r;s++){var u=y[t>>2],o=y[t+4>>2];t+=8;var l=me.write(e,b,u,o,a);if(l<0)return-1;if(n+=l,l<o)break;void 0!==a&&(a+=l)}return n})(pe.getStreamFromFD(e),t,r);return y[a>>2]=n,0}catch(e){if(void 0===me||"ErrnoError"!==e.name)throw e;return e.errno}},z:function(e,t,r){var a=J();try{Pe(e)(t,r)}catch(e){if(Q(a),e!==e+0)throw e;q(1,0)}}},Oe=await async function(){function e(e,r){var a;return Oe=e.exports,f=Oe.A,D(),B=Oe._a,a=Oe,t._lua_checkstack=a.C,t._lua_xmove=a.D,t._lua_atpanic=a.E,t._lua_version=a.F,t._lua_absindex=a.G,t._lua_gettop=a.H,t._lua_settop=a.I,t._lua_closeslot=a.J,t._lua_rotate=a.K,t._lua_copy=a.L,t._lua_pushvalue=a.M,t._lua_type=a.N,t._lua_typename=a.O,t._lua_iscfunction=a.P,t._lua_isinteger=a.Q,t._lua_isnumber=a.R,t._lua_isstring=a.S,t._lua_isuserdata=a.T,t._lua_rawequal=a.U,t._lua_arith=a.V,t._lua_compare=a.W,t._lua_stringtonumber=a.X,t._lua_tonumberx=a.Y,t._lua_tointegerx=a.Z,t._lua_toboolean=a._,t._lua_tolstring=a.$,t._lua_rawlen=a.aa,t._lua_tocfunction=a.ba,t._lua_touserdata=a.ca,t._lua_tothread=a.da,t._lua_topointer=a.ea,t._lua_pushnil=a.fa,t._lua_pushnumber=a.ga,t._lua_pushinteger=a.ha,t._lua_pushlstring=a.ia,t._lua_pushstring=a.ja,t._lua_pushcclosure=a.ka,t._lua_pushboolean=a.la,t._lua_pushlightuserdata=a.ma,t._lua_pushthread=a.na,t._lua_getglobal=a.oa,t._lua_gettable=a.pa,t._lua_getfield=a.qa,t._lua_geti=a.ra,t._lua_rawget=a.sa,t._lua_rawgeti=a.ta,t._lua_rawgetp=a.ua,t._lua_createtable=a.va,t._lua_getmetatable=a.wa,t._lua_getiuservalue=a.xa,t._lua_setglobal=a.ya,t._lua_settable=a.za,t._lua_setfield=a.Aa,t._lua_seti=a.Ba,t._lua_rawset=a.Ca,t._lua_rawsetp=a.Da,t._lua_rawseti=a.Ea,t._lua_setmetatable=a.Fa,t._lua_setiuservalue=a.Ga,t._lua_callk=a.Ha,t._lua_pcallk=a.Ia,t._lua_load=a.Ja,t._lua_dump=a.Ka,t._lua_status=a.La,t._lua_error=a.Ma,t._lua_next=a.Na,t._lua_toclose=a.Oa,t._lua_concat=a.Pa,t._lua_len=a.Qa,t._lua_getallocf=a.Ra,t._lua_setallocf=a.Sa,t._lua_setwarnf=a.Ta,t._lua_warning=a.Ua,t._lua_newuserdatauv=a.Va,t._lua_getupvalue=a.Wa,t._lua_setupvalue=a.Xa,t._lua_upvalueid=a.Ya,t._lua_upvaluejoin=a.Za,t._luaL_traceback=a.$a,t._lua_getstack=a.ab,t._lua_getinfo=a.bb,t._luaL_buffinit=a.cb,t._luaL_addstring=a.db,t._luaL_prepbuffsize=a.eb,t._luaL_addvalue=a.fb,t._luaL_pushresult=a.gb,t._luaL_argerror=a.hb,t._luaL_typeerror=a.ib,t._luaL_getmetafield=a.jb,t._luaL_where=a.kb,t._luaL_fileresult=a.lb,t._luaL_execresult=a.mb,t._luaL_newmetatable=a.nb,t._luaL_setmetatable=a.ob,t._luaL_testudata=a.pb,t._luaL_checkudata=a.qb,t._luaL_optlstring=a.rb,t._luaL_checklstring=a.sb,t._luaL_checkstack=a.tb,t._luaL_checktype=a.ub,t._luaL_checkany=a.vb,t._luaL_checknumber=a.wb,t._luaL_optnumber=a.xb,t._luaL_checkinteger=a.yb,t._luaL_optinteger=a.zb,t._luaL_setfuncs=a.Ab,t._luaL_addlstring=a.Bb,t._luaL_pushresultsize=a.Cb,t._luaL_buffinitsize=a.Db,t._luaL_ref=a.Eb,t._luaL_unref=a.Fb,t._luaL_loadfilex=a.Gb,t._luaL_loadbufferx=a.Hb,t._luaL_loadstring=a.Ib,t._luaL_callmeta=a.Jb,t._luaL_len=a.Kb,t._luaL_tolstring=a.Lb,t._luaL_getsubtable=a.Mb,t._luaL_requiref=a.Nb,t._luaL_addgsub=a.Ob,t._luaL_gsub=a.Pb,t._luaL_newstate=a.Qb,t._lua_newstate=a.Rb,t._free=a.Sb,t._realloc=a.Tb,t._luaL_checkversion_=a.Ub,t._luaopen_base=a.Vb,t._luaopen_coroutine=a.Wb,t._lua_newthread=a.Xb,t._lua_yieldk=a.Yb,t._lua_isyieldable=a.Zb,t._lua_resetthread=a._b,t._lua_resume=a.$b,t._luaopen_debug=a.ac,t._lua_gethookmask=a.bc,t._lua_gethook=a.cc,t._lua_gethookcount=a.dc,t._lua_getlocal=a.ec,t._lua_sethook=a.fc,t._lua_setlocal=a.gc,t._lua_setcstacklimit=a.hc,t._luaL_openlibs=a.ic,t._luaopen_package=a.jc,t._luaopen_table=a.kc,t._luaopen_io=a.lc,t._luaopen_os=a.mc,t._luaopen_string=a.nc,t._luaopen_math=a.oc,t._luaopen_utf8=a.pc,t._lua_close=a.qc,t._malloc=$=a.rc,q=a.sc,W=a.tc,G=a.uc,H=a.vc,R(),Oe}V();var r={a:ze};return M??=z(),e((await U(m,M,r)).instance)}();return function e(){A>0?C=e:(!function(){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)K(t.preRun.shift());Y(X)}(),A>0?C=e:(t.calledRun=!0,S||(P=!0,t.noFSInit||me.initialized||me.init(),le.init(),Oe.B(),me.ignorePermissions=!1,_?.(t))))}(),P?t:new Promise(((e,t)=>{_=e,p=t}))},C=class e{static async initialize(t,r){const a=await A({locateFile:(e,r)=>t||r+e,preRun:e=>{"object"==typeof r&&Object.entries(r).forEach((([t,r])=>e.ENV[t]=r))}});return new e(a)}module;luaL_checkversion_;luaL_getmetafield;luaL_callmeta;luaL_tolstring;luaL_argerror;luaL_typeerror;luaL_checklstring;luaL_optlstring;luaL_checknumber;luaL_optnumber;luaL_checkinteger;luaL_optinteger;luaL_checkstack;luaL_checktype;luaL_checkany;luaL_newmetatable;luaL_setmetatable;luaL_testudata;luaL_checkudata;luaL_where;luaL_fileresult;luaL_execresult;luaL_ref;luaL_unref;luaL_loadfilex;luaL_loadbufferx;luaL_loadstring;luaL_newstate;luaL_len;luaL_addgsub;luaL_gsub;luaL_setfuncs;luaL_getsubtable;luaL_traceback;luaL_requiref;luaL_buffinit;luaL_prepbuffsize;luaL_addlstring;luaL_addstring;luaL_addvalue;luaL_pushresult;luaL_pushresultsize;luaL_buffinitsize;lua_newstate;lua_close;lua_newthread;lua_resetthread;lua_atpanic;lua_version;lua_absindex;lua_gettop;lua_settop;lua_pushvalue;lua_rotate;lua_copy;lua_checkstack;lua_xmove;lua_isnumber;lua_isstring;lua_iscfunction;lua_isinteger;lua_isuserdata;lua_type;lua_typename;lua_tonumberx;lua_tointegerx;lua_toboolean;lua_tolstring;lua_rawlen;lua_tocfunction;lua_touserdata;lua_tothread;lua_topointer;lua_arith;lua_rawequal;lua_compare;lua_pushnil;lua_pushnumber;lua_pushinteger;lua_pushlstring;lua_pushstring;lua_pushcclosure;lua_pushboolean;lua_pushlightuserdata;lua_pushthread;lua_getglobal;lua_gettable;lua_getfield;lua_geti;lua_rawget;lua_rawgeti;lua_rawgetp;lua_createtable;lua_newuserdatauv;lua_getmetatable;lua_getiuservalue;lua_setglobal;lua_settable;lua_setfield;lua_seti;lua_rawset;lua_rawseti;lua_rawsetp;lua_setmetatable;lua_setiuservalue;lua_callk;lua_pcallk;lua_load;lua_dump;lua_yieldk;lua_resume;lua_status;lua_isyieldable;lua_setwarnf;lua_warning;lua_error;lua_next;lua_concat;lua_len;lua_stringtonumber;lua_getallocf;lua_setallocf;lua_toclose;lua_closeslot;lua_getstack;lua_getinfo;lua_getlocal;lua_setlocal;lua_getupvalue;lua_setupvalue;lua_upvalueid;lua_upvaluejoin;lua_sethook;lua_gethook;lua_gethookmask;lua_gethookcount;lua_setcstacklimit;luaopen_base;luaopen_coroutine;luaopen_table;luaopen_io;luaopen_os;luaopen_string;luaopen_utf8;luaopen_math;luaopen_debug;luaopen_package;luaL_openlibs;referenceTracker=new WeakMap;referenceMap=new Map;availableReferences=[];lastRefIndex;constructor(e){this.module=e,this.luaL_checkversion_=this.cwrap("luaL_checkversion_",null,["number","number","number"]),this.luaL_getmetafield=this.cwrap("luaL_getmetafield","number",["number","number","string"]),this.luaL_callmeta=this.cwrap("luaL_callmeta","number",["number","number","string"]),this.luaL_tolstring=this.cwrap("luaL_tolstring","string",["number","number","number"]),this.luaL_argerror=this.cwrap("luaL_argerror","number",["number","number","string"]),this.luaL_typeerror=this.cwrap("luaL_typeerror","number",["number","number","string"]),this.luaL_checklstring=this.cwrap("luaL_checklstring","string",["number","number","number"]),this.luaL_optlstring=this.cwrap("luaL_optlstring","string",["number","number","string","number"]),this.luaL_checknumber=this.cwrap("luaL_checknumber","number",["number","number"]),this.luaL_optnumber=this.cwrap("luaL_optnumber","number",["number","number","number"]),this.luaL_checkinteger=this.cwrap("luaL_checkinteger","number",["number","number"]),this.luaL_optinteger=this.cwrap("luaL_optinteger","number",["number","number","number"]),this.luaL_checkstack=this.cwrap("luaL_checkstack",null,["number","number","string"]),this.luaL_checktype=this.cwrap("luaL_checktype",null,["number","number","number"]),this.luaL_checkany=this.cwrap("luaL_checkany",null,["number","number"]),this.luaL_newmetatable=this.cwrap("luaL_newmetatable","number",["number","string"]),this.luaL_setmetatable=this.cwrap("luaL_setmetatable",null,["number","string"]),this.luaL_testudata=this.cwrap("luaL_testudata","number",["number","number","string"]),this.luaL_checkudata=this.cwrap("luaL_checkudata","number",["number","number","string"]),this.luaL_where=this.cwrap("luaL_where",null,["number","number"]),this.luaL_fileresult=this.cwrap("luaL_fileresult","number",["number","number","string"]),this.luaL_execresult=this.cwrap("luaL_execresult","number",["number","number"]),this.luaL_ref=this.cwrap("luaL_ref","number",["number","number"]),this.luaL_unref=this.cwrap("luaL_unref",null,["number","number","number"]),this.luaL_loadfilex=this.cwrap("luaL_loadfilex","number",["number","string","string"]),this.luaL_loadbufferx=this.cwrap("luaL_loadbufferx","number",["number","string|number","number","string|number","string"]),this.luaL_loadstring=this.cwrap("luaL_loadstring","number",["number","string"]),this.luaL_newstate=this.cwrap("luaL_newstate","number",[]),this.luaL_len=this.cwrap("luaL_len","number",["number","number"]),this.luaL_addgsub=this.cwrap("luaL_addgsub",null,["number","string","string","string"]),this.luaL_gsub=this.cwrap("luaL_gsub","string",["number","string","string","string"]),this.luaL_setfuncs=this.cwrap("luaL_setfuncs",null,["number","number","number"]),this.luaL_getsubtable=this.cwrap("luaL_getsubtable","number",["number","number","string"]),this.luaL_traceback=this.cwrap("luaL_traceback",null,["number","number","string","number"]),this.luaL_requiref=this.cwrap("luaL_requiref",null,["number","string","number","number"]),this.luaL_buffinit=this.cwrap("luaL_buffinit",null,["number","number"]),this.luaL_prepbuffsize=this.cwrap("luaL_prepbuffsize","string",["number","number"]),this.luaL_addlstring=this.cwrap("luaL_addlstring",null,["number","string","number"]),this.luaL_addstring=this.cwrap("luaL_addstring",null,["number","string"]),this.luaL_addvalue=this.cwrap("luaL_addvalue",null,["number"]),this.luaL_pushresult=this.cwrap("luaL_pushresult",null,["number"]),this.luaL_pushresultsize=this.cwrap("luaL_pushresultsize",null,["number","number"]),this.luaL_buffinitsize=this.cwrap("luaL_buffinitsize","string",["number","number","number"]),this.lua_newstate=this.cwrap("lua_newstate","number",["number","number"]),this.lua_close=this.cwrap("lua_close",null,["number"]),this.lua_newthread=this.cwrap("lua_newthread","number",["number"]),this.lua_resetthread=this.cwrap("lua_resetthread","number",["number"]),this.lua_atpanic=this.cwrap("lua_atpanic","number",["number","number"]),this.lua_version=this.cwrap("lua_version","number",["number"]),this.lua_absindex=this.cwrap("lua_absindex","number",["number","number"]),this.lua_gettop=this.cwrap("lua_gettop","number",["number"]),this.lua_settop=this.cwrap("lua_settop",null,["number","number"]),this.lua_pushvalue=this.cwrap("lua_pushvalue",null,["number","number"]),this.lua_rotate=this.cwrap("lua_rotate",null,["number","number","number"]),this.lua_copy=this.cwrap("lua_copy",null,["number","number","number"]),this.lua_checkstack=this.cwrap("lua_checkstack","number",["number","number"]),this.lua_xmove=this.cwrap("lua_xmove",null,["number","number","number"]),this.lua_isnumber=this.cwrap("lua_isnumber","number",["number","number"]),this.lua_isstring=this.cwrap("lua_isstring","number",["number","number"]),this.lua_iscfunction=this.cwrap("lua_iscfunction","number",["number","number"]),this.lua_isinteger=this.cwrap("lua_isinteger","number",["number","number"]),this.lua_isuserdata=this.cwrap("lua_isuserdata","number",["number","number"]),this.lua_type=this.cwrap("lua_type","number",["number","number"]),this.lua_typename=this.cwrap("lua_typename","string",["number","number"]),this.lua_tonumberx=this.cwrap("lua_tonumberx","number",["number","number","number"]),this.lua_tointegerx=this.cwrap("lua_tointegerx","number",["number","number","number"]),this.lua_toboolean=this.cwrap("lua_toboolean","number",["number","number"]),this.lua_tolstring=this.cwrap("lua_tolstring","string",["number","number","number"]),this.lua_rawlen=this.cwrap("lua_rawlen","number",["number","number"]),this.lua_tocfunction=this.cwrap("lua_tocfunction","number",["number","number"]),this.lua_touserdata=this.cwrap("lua_touserdata","number",["number","number"]),this.lua_tothread=this.cwrap("lua_tothread","number",["number","number"]),this.lua_topointer=this.cwrap("lua_topointer","number",["number","number"]),this.lua_arith=this.cwrap("lua_arith",null,["number","number"]),this.lua_rawequal=this.cwrap("lua_rawequal","number",["number","number","number"]),this.lua_compare=this.cwrap("lua_compare","number",["number","number","number","number"]),this.lua_pushnil=this.cwrap("lua_pushnil",null,["number"]),this.lua_pushnumber=this.cwrap("lua_pushnumber",null,["number","number"]),this.lua_pushinteger=this.cwrap("lua_pushinteger",null,["number","number"]),this.lua_pushlstring=this.cwrap("lua_pushlstring","string",["number","string|number","number"]),this.lua_pushstring=this.cwrap("lua_pushstring","string",["number","string|number"]),this.lua_pushcclosure=this.cwrap("lua_pushcclosure",null,["number","number","number"]),this.lua_pushboolean=this.cwrap("lua_pushboolean",null,["number","number"]),this.lua_pushlightuserdata=this.cwrap("lua_pushlightuserdata",null,["number","number"]),this.lua_pushthread=this.cwrap("lua_pushthread","number",["number"]),this.lua_getglobal=this.cwrap("lua_getglobal","number",["number","string"]),this.lua_gettable=this.cwrap("lua_gettable","number",["number","number"]),this.lua_getfield=this.cwrap("lua_getfield","number",["number","number","string"]),this.lua_geti=this.cwrap("lua_geti","number",["number","number","number"]),this.lua_rawget=this.cwrap("lua_rawget","number",["number","number"]),this.lua_rawgeti=this.cwrap("lua_rawgeti","number",["number","number","number"]),this.lua_rawgetp=this.cwrap("lua_rawgetp","number",["number","number","number"]),this.lua_createtable=this.cwrap("lua_createtable",null,["number","number","number"]),this.lua_newuserdatauv=this.cwrap("lua_newuserdatauv","number",["number","number","number"]),this.lua_getmetatable=this.cwrap("lua_getmetatable","number",["number","number"]),this.lua_getiuservalue=this.cwrap("lua_getiuservalue","number",["number","number","number"]),this.lua_setglobal=this.cwrap("lua_setglobal",null,["number","string"]),this.lua_settable=this.cwrap("lua_settable",null,["number","number"]),this.lua_setfield=this.cwrap("lua_setfield",null,["number","number","string"]),this.lua_seti=this.cwrap("lua_seti",null,["number","number","number"]),this.lua_rawset=this.cwrap("lua_rawset",null,["number","number"]),this.lua_rawseti=this.cwrap("lua_rawseti",null,["number","number","number"]),this.lua_rawsetp=this.cwrap("lua_rawsetp",null,["number","number","number"]),this.lua_setmetatable=this.cwrap("lua_setmetatable","number",["number","number"]),this.lua_setiuservalue=this.cwrap("lua_setiuservalue","number",["number","number","number"]),this.lua_callk=this.cwrap("lua_callk",null,["number","number","number","number","number"]),this.lua_pcallk=this.cwrap("lua_pcallk","number",["number","number","number","number","number","number"]),this.lua_load=this.cwrap("lua_load","number",["number","number","number","string","string"]),this.lua_dump=this.cwrap("lua_dump","number",["number","number","number","number"]),this.lua_yieldk=this.cwrap("lua_yieldk","number",["number","number","number","number"]),this.lua_resume=this.cwrap("lua_resume","number",["number","number","number","number"]),this.lua_status=this.cwrap("lua_status","number",["number"]),this.lua_isyieldable=this.cwrap("lua_isyieldable","number",["number"]),this.lua_setwarnf=this.cwrap("lua_setwarnf",null,["number","number","number"]),this.lua_warning=this.cwrap("lua_warning",null,["number","string","number"]),this.lua_error=this.cwrap("lua_error","number",["number"]),this.lua_next=this.cwrap("lua_next","number",["number","number"]),this.lua_concat=this.cwrap("lua_concat",null,["number","number"]),this.lua_len=this.cwrap("lua_len",null,["number","number"]),this.lua_stringtonumber=this.cwrap("lua_stringtonumber","number",["number","string"]),this.lua_getallocf=this.cwrap("lua_getallocf","number",["number","number"]),this.lua_setallocf=this.cwrap("lua_setallocf",null,["number","number","number"]),this.lua_toclose=this.cwrap("lua_toclose",null,["number","number"]),this.lua_closeslot=this.cwrap("lua_closeslot",null,["number","number"]),this.lua_getstack=this.cwrap("lua_getstack","number",["number","number","number"]),this.lua_getinfo=this.cwrap("lua_getinfo","number",["number","string","number"]),this.lua_getlocal=this.cwrap("lua_getlocal","string",["number","number","number"]),this.lua_setlocal=this.cwrap("lua_setlocal","string",["number","number","number"]),this.lua_getupvalue=this.cwrap("lua_getupvalue","string",["number","number","number"]),this.lua_setupvalue=this.cwrap("lua_setupvalue","string",["number","number","number"]),this.lua_upvalueid=this.cwrap("lua_upvalueid","number",["number","number","number"]),this.lua_upvaluejoin=this.cwrap("lua_upvaluejoin",null,["number","number","number","number","number"]),this.lua_sethook=this.cwrap("lua_sethook",null,["number","number","number","number"]),this.lua_gethook=this.cwrap("lua_gethook","number",["number"]),this.lua_gethookmask=this.cwrap("lua_gethookmask","number",["number"]),this.lua_gethookcount=this.cwrap("lua_gethookcount","number",["number"]),this.lua_setcstacklimit=this.cwrap("lua_setcstacklimit","number",["number","number"]),this.luaopen_base=this.cwrap("luaopen_base","number",["number"]),this.luaopen_coroutine=this.cwrap("luaopen_coroutine","number",["number"]),this.luaopen_table=this.cwrap("luaopen_table","number",["number"]),this.luaopen_io=this.cwrap("luaopen_io","number",["number"]),this.luaopen_os=this.cwrap("luaopen_os","number",["number"]),this.luaopen_string=this.cwrap("luaopen_string","number",["number"]),this.luaopen_utf8=this.cwrap("luaopen_utf8","number",["number"]),this.luaopen_math=this.cwrap("luaopen_math","number",["number"]),this.luaopen_debug=this.cwrap("luaopen_debug","number",["number"]),this.luaopen_package=this.cwrap("luaopen_package","number",["number"]),this.luaL_openlibs=this.cwrap("luaL_openlibs",null,["number"])}lua_remove(e,t){this.lua_rotate(e,t,-1),this.lua_pop(e,1)}lua_pop(e,t){this.lua_settop(e,-t-1)}luaL_getmetatable(e,t){return this.lua_getfield(e,o,t)}lua_yield(e,t){return this.lua_yieldk(e,t,0,null)}lua_upvalueindex(e){return o-e}ref(e){const t=this.referenceTracker.get(e);if(t)return t.refCount++,t.index;const r=this.availableReferences.pop(),a=void 0===r?this.referenceMap.size+1:r;return this.referenceMap.set(a,e),this.referenceTracker.set(e,{refCount:1,index:a}),this.lastRefIndex=a,a}unref(e){const t=this.referenceMap.get(e);if(void 0===t)return;const r=this.referenceTracker.get(t);if(void 0===r)return this.referenceTracker.delete(t),void this.availableReferences.push(e);r.refCount--,r.refCount<=0&&(this.referenceTracker.delete(t),this.referenceMap.delete(e),this.availableReferences.push(e))}getRef(e){return this.referenceMap.get(e)}getLastRefIndex(){return this.lastRefIndex}printRefs(){for(const[e,t]of this.referenceMap.entries())console.log(e,t)}cwrap(e,t,r){return r.some((e=>"string|number"===e))?(...a)=>{const n=[],s=r.map(((e,t)=>{if("string|number"===e){if("number"==typeof a[t])return"number";if(a[t]?.length>1024){const e=this.module.stringToNewUTF8(a[t]);return a[t]=e,n.push(e),"number"}return"string"}return e}));try{return this.module.ccall(e,t,s,a)}finally{for(const e of n)this.module._free(e)}}:(...a)=>this.module.ccall(e,t,r,a)}};e.Decoration=t,e.LUAI_MAXSTACK=u,e.LUA_MULTRET=-1,e.LUA_REGISTRYINDEX=o,e.LuaEngine=M,e.LuaEventCodes=c,e.LuaEventMasks=d,e.LuaFactory=class{luaWasmPromise;constructor(e,t){if(void 0===e){("object"==typeof window&&void 0!==window.document||"object"==typeof self&&"DedicatedWorkerGlobalScope"===self?.constructor?.name)&&(e="https://unpkg.com/webx-wasmoon@1.16.3/dist/glue.wasm")}this.luaWasmPromise=C.initialize(e,t)}async mountFile(e,t){this.mountFileSync(await this.getLuaModule(),e,t)}mountFileSync(e,t,r){const a=t.lastIndexOf("/"),n=t.substring(a+1),s=t.substring(0,t.length-n.length-1);if(s.length>0){const t=s.split("/").reverse();let r="";for(;t.length;){const a=t.pop();if(!a)continue;const n=`${r}/${a}`;try{e.module.FS.mkdir(n)}catch{}r=n}}e.module.FS.writeFile(t,r)}async createEngine(e={}){return new M(await this.getLuaModule(),e)}async getLuaModule(){return this.luaWasmPromise}},e.LuaGlobal=g,e.LuaLibraries=_,e.LuaMultiReturn=r,e.LuaRawResult=y,e.LuaReturn=n,e.LuaThread=b,e.LuaTimeoutError=f,e.LuaType=l,e.LuaTypeExtension=w,e.LuaWasm=C,e.PointerSize=4,e.decorate=function(e,r){return new t(e,r)},e.decorateFunction=k,e.decorateProxy=S,e.decorateUserdata=function(e){return new t(e,{reference:!0})}}));
//# sourceMappingURL=/sm/e5b9b3ea366ebc25eb794ad066826d2c73f854ce9616546cc9d0bbeb29c88094.map
